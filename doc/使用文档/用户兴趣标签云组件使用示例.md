# 用户兴趣标签云组件使用示例

## 组件介绍

用户兴趣标签云组件（`interest-tag-cloud`）用于在页面中显示用户的兴趣标签，支持自动加载、刷新和点击交互。

## 组件特性

- 自动加载用户兴趣数据
- 支持手动刷新
- 支持标签点击交互
- 支持自定义标签颜色和字体大小
- 支持显示或隐藏分类信息
- 支持自定义最大标签数量

## 使用方法

### 1. 在页面 JSON 中引入组件

```json
{
  "usingComponents": {
    "interest-tag-cloud": "../../components/interest-tag-cloud/interest-tag-cloud"
  }
}
```

### 2. 在页面 WXML 中使用组件

```html
<interest-tag-cloud 
  id="interestTagCloud"
  userId="{{openId}}"
  maxTags="30"
  minFontSize="12"
  maxFontSize="20"
  showCategory="{{true}}"
  bind:tagclick="handleTagClick"
  bind:loaded="handleTagsLoaded"
  bind:error="handleTagsError"
></interest-tag-cloud>
```

### 3. 在页面 JS 中处理组件事件

```javascript
Page({
  data: {
    openId: '' // 用户ID
  },
  
  onLoad() {
    // 获取用户ID
    const openId = wx.getStorageSync('openId');
    this.setData({ openId });
  },
  
  onShow() {
    // 加载标签云
    this.loadInterestTags();
  },
  
  // 加载用户兴趣标签
  loadInterestTags(forceRefresh = false) {
    const tagCloud = this.selectComponent('#interestTagCloud');
    if (tagCloud) {
      tagCloud.loadTags(forceRefresh);
    }
  },
  
  // 刷新标签
  refreshInterestTags() {
    this.loadInterestTags(true);
    
    wx.showToast({
      title: '正在刷新标签',
      icon: 'loading',
      duration: 1000
    });
  },
  
  // 处理标签点击事件
  handleTagClick(e) {
    const { tag } = e.detail;
    console.log('点击了标签:', tag);
    
    // 显示标签详情
    wx.showModal({
      title: '兴趣标签',
      content: `标签: ${tag.name}\n分类: ${tag.category || '未分类'}\n权重: ${tag.value}%`,
      showCancel: false
    });
  },
  
  // 处理标签加载完成事件
  handleTagsLoaded(e) {
    const { tags } = e.detail;
    console.log('兴趣标签加载完成, 数量:', tags.length);
  },
  
  // 处理标签加载错误事件
  handleTagsError(e) {
    const { error } = e.detail;
    console.error('兴趣标签加载错误:', error);
    
    wx.showToast({
      title: '标签加载失败',
      icon: 'error',
      duration: 1500
    });
  }
});
```

### 4. 在页面 WXSS 中添加样式（可选）

```css
/* 标签云容器样式 */
.interest-tag-container {
  width: 100%;
  min-height: 200rpx;
  padding: 16rpx 0;
  background-color: var(--secondary-color);
  border-radius: 16rpx;
  overflow: hidden;
}
```

## 组件属性

| 属性名 | 类型 | 默认值 | 说明 |
| --- | --- | --- | --- |
| userId | String | '' | 用户ID，必填 |
| maxTags | Number | 20 | 最大显示标签数量 |
| minFontSize | Number | 12 | 最小字体大小（单位：px） |
| maxFontSize | Number | 24 | 最大字体大小（单位：px） |
| colorMap | Object | 预设颜色映射 | 分类颜色映射对象 |
| showCategory | Boolean | true | 是否显示分类信息 |
| autoRefresh | Boolean | false | 是否自动刷新 |

## 组件事件

| 事件名 | 说明 | 事件详情 |
| --- | --- | --- |
| tagclick | 标签点击事件 | `{tag: {name, value, category, color}}` |
| loaded | 标签加载完成事件 | `{tags: Array}` |
| error | 标签加载错误事件 | `{error: Error}` |
| refresh | 标签刷新事件 | 无 |

## 组件方法

| 方法名 | 参数 | 说明 |
| --- | --- | --- |
| loadTags | forceRefresh: Boolean | 加载标签数据，forceRefresh为true时强制刷新 |
| handleRefresh | 无 | 处理刷新按钮点击事件 |

## 示例效果

标签云组件会根据用户兴趣数据生成不同大小和颜色的标签，用户可以点击标签查看详情，也可以点击刷新按钮刷新标签数据。

## 注意事项

1. 确保用户已登录并且有有效的用户ID
2. 标签云组件需要调用云函数获取用户兴趣数据，请确保云函数已部署
3. 标签云组件会自动缓存用户兴趣数据，减少不必要的网络请求
4. 如需强制刷新数据，可以调用组件的loadTags方法并传入true参数

# GetRoleInfo 云函数文档

## 功能描述

GetRoleInfo云函数是一个**角色信息查询服务**，提供根据角色ID查询角色详细信息的功能，支持获取角色的基本信息、提示词和配置。

## 文件结构

- **`index.js`** - 主入口文件，实现角色信息查询逻辑

## 主要流程

### 1. 角色信息查询流程
```
接收请求 → 参数验证 → 查询角色信息 → 检查查询结果 → 返回角色数据
```

## 数据流向

### 输入数据
- `roleId` - 角色ID（必需）

### 处理过程
1. **参数验证**：检查roleId是否存在
2. **数据库查询**：根据ID查询roles集合
3. **结果检查**：验证查询结果是否为空
4. **数据返回**：返回角色详细信息或错误信息

### 输出数据
- 操作成功状态
- 角色详细信息
- 微信上下文信息（openid）
- 错误信息（如果有）

## 涉及的数据库集合

### roles（角色表）
```javascript
{
  _id: "角色ID",
  name: "角色名称",
  description: "角色描述",
  prompt: "角色提示词",
  avatar: "角色头像URL",
  category: "角色分类",
  tags: ["标签1", "标签2"],
  is_public: true,
  usage_count: 0,
  created_by: "创建者ID",
  created_at: "创建时间",
  updated_at: "更新时间",
  
  // 扩展字段
  system_prompt: "系统提示词",
  personality: "性格特征",
  background: "背景故事",
  speaking_style: "说话风格",
  expertise: "专业领域",
  limitations: "限制条件",
  examples: ["示例对话1", "示例对话2"]
}
```

## API接口

### 请求格式
```javascript
{
  roleId: "角色ID" // 必需
}
```

### 响应格式（成功）
```javascript
{
  success: true,
  data: {
    _id: "角色ID",
    name: "角色名称",
    description: "角色描述",
    prompt: "角色提示词",
    avatar: "角色头像URL",
    category: "角色分类",
    tags: ["标签1", "标签2"],
    is_public: true,
    usage_count: 100,
    created_by: "创建者ID",
    created_at: "创建时间",
    updated_at: "更新时间"
  },
  openid: "用户openid"
}
```

### 响应格式（失败）
```javascript
{
  success: false,
  error: "缺少必要参数: roleId" 或 "未找到角色信息" 或 "系统错误信息",
  openid: "用户openid"
}
```

## 错误处理

### 参数验证错误
- 缺少roleId参数
- 返回明确的错误信息

### 查询错误
- 角色不存在
- 数据库查询失败
- 返回具体的错误原因

### 系统错误
- 捕获所有异常
- 返回详细的错误信息

## 使用场景

1. **角色详情展示**：在前端展示角色的详细信息
2. **聊天准备**：获取角色提示词用于AI对话
3. **角色管理**：为角色管理界面提供数据支持
4. **推荐系统**：基于角色信息进行个性化推荐

## 注意事项

- 硬编码了云环境ID，需要根据实际环境修改
- 返回的角色信息包含敏感字段（如prompt），需要在前端做好权限控制
- 查询结果为空时返回明确的错误信息
- 需要确保roles集合存在且有正确权限

## 性能优化

- 直接根据ID查询，效率较高
- 返回单个角色数据，避免大量数据传输
- 错误处理完善，提供明确反馈

## 扩展建议

1. **缓存机制**：对热门角色信息进行缓存
2. **批量查询**：支持一次查询多个角色信息
3. **权限控制**：根据用户权限过滤敏感字段
4. **使用统计**：更新角色使用次数统计
<!-- components/model-selector/model-selector.wxml -->
<view class="model-selector {{darkMode ? 'dark' : ''}}">
  <!-- 当前选择的模型 -->
  <view class="selected-model" bindtap="showModelSelector">
    <view class="model-icon">
      <view class="model-icon-bg {{selectedModelType}}">
        <text class="model-icon-text">{{modelDisplayNames[selectedModelType].substr(0, 1)}}</text>
      </view>
    </view>
    <view class="model-name">
      <text>{{modelDisplayNames[selectedModelType]}}</text>
      <text class="model-subname">{{selectedModel}}</text>
    </view>
    <view class="arrow-icon">
      <view class="arrow-down"></view>
    </view>
  </view>

  <!-- 模型类型选择弹窗 -->
  <view class="model-selector-popup {{showSelector ? 'show' : ''}}" catchtap="hideModelSelector">
    <view class="model-selector-content" catchtap="stopPropagation">
      <view class="popup-header">
        <text class="popup-title">选择AI模型平台</text>
        <view class="close-btn" bindtap="hideModelSelector">
          <view class="close-icon"></view>
        </view>
      </view>

      <view class="model-list">
        <block wx:for="{{modelTypes}}" wx:key="*this">
          <view class="model-item {{item === selectedModelType ? 'selected' : ''}}"
                data-model-type="{{item}}"
                bindtap="selectModelType">
            <view class="model-item-icon">
              <view class="model-icon-bg {{item}}">
                <text class="model-icon-text">{{modelDisplayNames[item].substr(0, 1)}}</text>
              </view>
            </view>
            <view class="model-item-info">
              <view class="model-item-name">{{modelDisplayNames[item]}}</view>
              <view class="model-item-desc">{{modelShortDescriptions[item] || '提供高质量的对话生成能力'}}</view>
              <!-- API密钥状态指示器 -->
              <view class="api-key-status {{apiKeyStatus[item] ? 'valid' : 'invalid'}}">
                <view class="status-dot"></view>
                <text class="status-text">{{apiKeyStatus[item] ? 'API密钥有效' : 'API密钥未设置'}}</text>
              </view>
            </view>
            <view class="model-item-check" wx:if="{{item === selectedModelType}}">
              <view class="check-icon"></view>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- 模型列表选择弹窗 -->
  <view class="model-selector-popup {{showModelList ? 'show' : ''}}" catchtap="hideModelListSelector">
    <view class="model-selector-content" catchtap="stopPropagation">
      <view class="popup-header">
        <text class="popup-title">选择{{modelDisplayNames[selectedModelType]}}模型</text>
        <view class="close-btn" bindtap="hideModelListSelector">
          <view class="close-icon"></view>
        </view>
      </view>

      <view class="model-list">
        <block wx:for="{{currentModelList}}" wx:key="*this">
          <view class="model-item {{item === selectedModel ? 'selected' : ''}}"
                data-model-name="{{item}}"
                bindtap="selectModel">
            <view class="model-item-icon">
              <view class="model-icon-bg {{selectedModelType}}">
                <text class="model-icon-text">M</text>
              </view>
            </view>
            <view class="model-item-info">
              <view class="model-item-name">{{item}}</view>
              <view class="model-item-desc">{{modelDescriptions[selectedModelType]}}</view>
            </view>
            <view class="model-item-check" wx:if="{{item === selectedModel}}">
              <view class="check-icon"></view>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- 加载中遮罩 -->
  <view class="loading-overlay {{loading ? 'show' : ''}}" catchtap="stopPropagation">
    <view class="loading-spinner"></view>
    <text class="loading-text">正在连接模型...</text>
  </view>
</view>

<!--components/emotion-panel/emotion-panel.wxml-->
<view class="emotion-panel-container {{show ? 'show' : ''}} {{darkMode ? 'dark' : ''}}">
  <view class="panel-mask" bindtap="closePanel"></view>
  <view class="emotion-panel {{emotionData.type}}" catchtap="stopPropagation">
    <!-- é¢æ¿å¤´éƒ¨ -->
    <view class="panel-header">
      <text class="panel-title">æƒ…æ„Ÿåˆ†æ</text>
      <view class="close-btn" bindtap="closePanel">Ã—</view>
    </view>

    <!-- æƒ…æ„Ÿé¥¼å›¾ -->
    <view class="emotion-pie-container">
      <emotion-pie emotion="{{emotionData}}" darkMode="{{darkMode}}" bind:select="onEmotionSelect"></emotion-pie>
    </view>

    <!-- æƒ…æ„ŸæŠ¥å‘Š -->
    <view class="emotion-report">
      <text class="report-title">æƒ…æ„ŸæŠ¥å‘Š</text>
      <text class="report-content">{{emotionData.summary || emotionData.report}}</text>
    </view>

    <!-- æƒ…æ„Ÿè¯¦æƒ… -->
    <view class="emotion-details">
      <text class="details-title">æƒ…æ„Ÿè¯¦æƒ…</text>

      <view class="details-item">
        <text class="detail-label">ä¸»è¦æƒ…æ„Ÿï¼š</text>
        <text class="detail-value">{{emotionLabels[emotionData.primary_emotion || emotionData.type] || emotionData.primary_emotion || emotionData.type}}</text>
      </view>

      <view class="details-item" wx:if="{{emotionData.secondary_emotions && emotionData.secondary_emotions.length}}">
        <text class="detail-label">æ¬¡è¦æƒ…æ„Ÿï¼š</text>
        <view class="detail-tags">
          <text wx:for="{{emotionData.secondary_emotions}}" wx:key="index" class="detail-tag">{{emotionLabels[item] || item}}</text>
        </view>
      </view>

      <view class="details-item">
        <text class="detail-label">æƒ…æ„Ÿå¼ºåº¦ï¼š</text>
        <text class="detail-value">{{intensityText}}</text>
      </view>

      <view class="details-item" wx:if="{{emotionData.valence !== undefined}}">
        <text class="detail-label">æƒ…æ„Ÿææ€§ï¼š</text>
        <text class="detail-value">{{polarityText}}</text>
      </view>

      <view class="details-item" wx:if="{{emotionData.trend && emotionData.trend !== 'unknown'}}">
        <text class="detail-label">æƒ…ç»ªè¶‹åŠ¿ï¼š</text>
        <text class="detail-value">{{trendText}}</text>
      </view>

      <view class="details-item">
        <text class="detail-label">ä¸»é¢˜å…³é”®è¯ï¼š</text>
        <view class="detail-tags">
          <text wx:for="{{emotionData.topic_keywords || emotionData.keywords}}" wx:key="index" class="detail-tag">{{item}}</text>
          <text wx:if="{{!hasKeywords}}" class="no-data">æ— å…³é”®è¯</text>
        </view>
      </view>

      <view class="details-item" wx:if="{{emotionData.emotion_triggers && emotionData.emotion_triggers.length}}">
        <text class="detail-label">æƒ…ç»ªè§¦å‘è¯ï¼š</text>
        <view class="detail-tags">
          <text wx:for="{{emotionData.emotion_triggers}}" wx:key="index" class="detail-tag">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- å»ºè®®åˆ—è¡¨ -->
    <view class="emotion-suggestions">
      <text class="suggestions-title">å»ºè®®</text>
      <view class="suggestions-list">
        <view class="suggestion-item" wx:for="{{emotionData.suggestions}}" wx:key="index">
          <text class="suggestion-icon">ğŸ’¡</text>
          <text class="suggestion-text">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="action-btn switch-role-btn" bindtap="switchRole">
        <text class="btn-icon">ğŸ‘¤</text>
        <text class="btn-text">åˆ‡æ¢è§’è‰²</text>
      </button>
      <button class="action-btn save-btn" bindtap="saveEmotion">
        <text class="btn-icon">ğŸ’¾</text>
        <text class="btn-text">ä¿å­˜è®°å½•</text>
      </button>
      <button class="action-btn history-btn" bindtap="viewHistory">
        <text class="btn-icon">ğŸ“Š</text>
        <text class="btn-text">å†å²è®°å½•</text>
      </button>
    </view>
  </view>
</view>

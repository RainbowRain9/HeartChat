<!--pages/emotionTest/emotionTest.wxml-->
<view class="container {{darkMode ? 'dark' : ''}}">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <text class="title">æƒ…æ„Ÿåˆ†ææµ‹è¯•</text>
    <view class="theme-toggle" bindtap="toggleTheme">
      <text class="toggle-icon">{{darkMode ? 'ğŸŒ™' : 'â˜€ï¸'}}</text>
    </view>
  </view>

  <!-- å½“å‰è§’è‰² -->
  <view class="current-role" wx:if="{{currentRole}}">
    <text class="role-label">å½“å‰è§’è‰²:</text>
    <text class="role-name">{{currentRole.role_name}}</text>
  </view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-area">
    <textarea class="text-input"
              placeholder="è¯·è¾“å…¥æ–‡æœ¬è¿›è¡Œæƒ…æ„Ÿåˆ†æ..."
              value="{{text}}"
              bindinput="onInputChange"
              maxlength="500"
              auto-height></textarea>
    <view class="char-count">{{text.length}}/500</view>
  </view>

  <!-- æŒ‰é’®åŒºåŸŸ -->
  <view class="button-area">
    <button class="analyze-btn"
            bindtap="analyzeEmotion"
            loading="{{loading}}">
      åˆ†ææƒ…æ„Ÿ
    </button>
    <button class="history-btn" bindtap="onViewHistory">
      å†å²è®°å½•
    </button>
  </view>

  <!-- æƒ…æ„Ÿåˆ†æé¢æ¿ -->
  <emotion-panel emotion="{{emotion}}"
                show="{{showEmotionPanel}}"
                darkMode="{{darkMode}}"
                bind:close="closeEmotionPanel"
                bind:switchRole="onSwitchRole"
                bind:save="onSaveEmotion"
                bind:history="onViewHistory"></emotion-panel>

  <!-- æƒ…æ„Ÿå†å²è®°å½• -->
  <emotion-history show="{{showEmotionHistory}}"
                  userId="{{userInfo.openId || userInfo._openid}}"
                  roleId="{{currentRole._id}}"
                  darkMode="{{darkMode}}"
                  bind:close="closeEmotionHistory"
                  bind:detail="onViewRecordDetail"></emotion-history>
</view>

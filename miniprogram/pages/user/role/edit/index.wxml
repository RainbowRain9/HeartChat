<!-- 角色编辑页 -->
<view class="role-edit">
  <form bindsubmit="handleSubmit">
    <!-- 头像上传区域 -->
    <view class="avatar-section">
      <view class="avatar-container" bindtap="chooseAvatar">
        <image class="avatar" src="{{form.avatar_url || '/assets/images/default-avatar.png'}}" mode="aspectFill"/>
        <view class="avatar-overlay">
          <text class="iconfont icon-camera"></text>
          <text class="upload-text">更换头像</text>
        </view>
      </view>
    </view>

    <!-- 基本信息表单 -->
    <view class="form-section">
      <view class="section-title">基本信息</view>
      
      <view class="form-item">
        <text class="label required">角色名称</text>
        <input 
          class="input {{form.role_name ? 'filled' : ''}}" 
          name="role_name" 
          value="{{form.role_name}}" 
          placeholder="给这个角色起个名字吧"
          maxlength="50"
        />
      </view>

      <view class="form-item">
        <text class="label required">角色类型</text>
        <view class="radio-group-container">
          <radio-group class="radio-group" bindchange="handleTypeChange">
            <label class="radio-label {{form.role_type === 'work' ? 'active' : ''}}">
              <radio value="work" checked="{{form.role_type === 'work'}}"/>
              <text class="radio-text">工作关系</text>
            </label>
            <label class="radio-label {{form.role_type === 'life' ? 'active' : ''}}">
              <radio value="life" checked="{{form.role_type === 'life'}}"/>
              <text class="radio-text">生活关系</text>
            </label>
          </radio-group>
        </view>
      </view>

      <view class="form-item">
        <text class="label required">关系</text>
        <picker 
          bindchange="handleRelationChange" 
          value="{{relationIndex}}" 
          range="{{relationTypes[form.role_type]}}"
        >
          <view class="picker {{form.relationship ? 'filled' : ''}}">
            {{form.relationship || '选择具体关系类型'}}
            <text class="iconfont icon-arrow-down"></text>
          </view>
        </picker>
      </view>

      <view class="form-item">
        <text class="label">性格风格</text>
        <input 
          class="input {{form.style ? 'filled' : ''}}" 
          name="style" 
          value="{{form.style}}" 
          placeholder="描述角色的性格特点，如：严谨专业"
        />
      </view>

      <view class="form-item">
        <text class="label">禁忌话题</text>
        <input 
          class="input {{form.taboo ? 'filled' : ''}}" 
          name="taboo" 
          value="{{form.taboo}}" 
          placeholder="设置不想谈论的话题"
        />
      </view>
    </view>

    <!-- 详细设置表单 -->
    <view class="form-section">
      <view class="section-title">详细设置</view>
      
      <view class="form-item">
        <text class="label">角色描述</text>
        <textarea 
          class="textarea {{form.role_desc ? 'filled' : ''}}" 
          name="role_desc" 
          value="{{form.role_desc}}" 
          placeholder="详细描述这个角色的特点、背景等"
          maxlength="500"
        />
      </view>

      <view class="form-item">
        <text class="label">说话风格</text>
        <textarea 
          class="textarea {{speaking_style ? 'filled' : ''}}"
          placeholder="描述角色说话的特点，如：温和有礼、幽默风趣" 
          value="{{speaking_style}}"
          data-field="speaking_style"
          bindinput="onInput"
        />
      </view>

      <view class="form-item">
        <text class="label">背景故事</text>
        <textarea 
          class="textarea {{background ? 'filled' : ''}}"
          placeholder="添加角色的背景故事，让对话更有代入感" 
          value="{{background}}"
          data-field="background"
          bindinput="onInput"
        />
      </view>

      <view class="form-item">
        <text class="label">提示词模板</text>
        <textarea 
          class="textarea {{prompt_template ? 'filled' : ''}}"
          placeholder="自定义提示词模板，可使用变量：{{role_name}}、{{style}}等" 
          value="{{prompt_template}}"
          data-field="prompt_template"
          bindinput="onInput"
        />
      </view>

      <view class="preview-section">
        <button class="preview-btn" bindtap="previewPrompt">
          <text class="iconfont icon-preview"></text>
          <text>预览生成的提示词</text>
        </button>
      </view>
    </view>

    <!-- 底部按钮区域 -->
    <view class="button-section">
      <button 
        class="submit-btn {{submitting ? 'loading' : ''}}" 
        form-type="submit" 
        loading="{{submitting}}"
      >
        {{isEdit ? '保存修改' : '创建角色'}}
      </button>
      <button class="cancel-btn" bindtap="handleCancel">取消</button>
    </view>
  </form>
</view> 
# 情绪历史页面开发计划书

## 1. 页面概述

情绪历史页面将展示用户的情绪变化趋势、情绪分布、情绪波动指数和情绪日历等数据，帮助用户了解自己的情绪变化规律。页面将包含多种图表和数据可视化组件，以直观的方式呈现用户的情绪数据。

## 2. 页面结构

### 2.1 文件结构
```
miniprogram/packageEmotion/pages/emotion-history/
├── emotion-history.js       // 页面逻辑
├── emotion-history.json     // 页面配置
├── emotion-history.wxml     // 页面结构
└── emotion-history.wxss     // 页面样式
```

### 2.2 页面布局
- 顶部导航栏：包含返回按钮和页面标题
- 时间范围选择：一周、一个月、三个月、半年、一年
- 情绪趋势图：展示不同情绪类型随时间的变化趋势
- 情绪分布图：展示各种情绪类型的占比分布
- 情绪波动指数：展示情绪波动程度及与上周的对比
- 情绪日历：以日历形式展示每天的主要情绪状态
- 最近情绪记录列表：展示最近的情绪分析记录

## 3. 数据结构

### 3.1 情绪历史数据
```javascript
{
  // 情绪趋势数据
  emotionTrend: [
    {
      date: '4/20', // 日期
      positive: 65, // 积极情绪占比
      neutral: 20,  // 中性情绪占比
      negative: 15  // 消极情绪占比
    },
    // 更多日期数据...
  ],
  
  // 情绪分布数据
  emotionDistribution: [
    { type: '疲惫', value: 25, color: '#ffc107' },
    { type: '压力', value: 20, color: '#f56565' },
    // 更多情绪类型...
  ],
  
  // 情绪波动指数
  volatilityIndex: {
    current: 65,      // 当前波动指数
    previous: 58,     // 上周波动指数
    changePercent: 12 // 变化百分比
  },
  
  // 情绪日历数据
  emotionCalendar: [
    { date: '2023-04-01', emotion: 'positive', color: 'green-100' },
    { date: '2023-04-02', emotion: 'positive', color: 'green-100' },
    // 更多日期数据...
  ],
  
  // 最近情绪记录
  recentRecords: [
    {
      id: 'record1',
      emotions: ['疲惫', '压力'],
      time: '今天 15:30',
      source: '与知心姐姐的对话',
      iconColor: 'red-100',
      iconName: 'tired'
    },
    // 更多记录...
  ]
}
```

## 4. 功能实现

### 4.1 数据获取
- 使用 `emotionService.js` 中的方法获取情绪历史数据
- 根据选择的时间范围调整数据查询参数
- 处理数据格式，适配图表组件需要的数据结构

### 4.2 图表实现
- 使用 `ec-canvas` 组件实现各种图表
- 情绪趋势图：使用折线图展示情绪随时间的变化
- 情绪分布图：使用饼图或环形图展示情绪类型分布
- 情绪波动指数：使用柱状图展示波动指数变化

### 4.3 情绪日历
- 使用网格布局实现日历视图
- 根据情绪类型设置不同的背景颜色
- 支持点击日期查看详细情绪记录

### 4.4 最近情绪记录列表
- 使用列表组件展示最近的情绪记录
- 支持点击记录查看详情
- 根据情绪类型显示不同的图标和颜色

## 5. 交互设计

### 5.1 时间范围选择
- 点击不同的时间范围选项，切换数据展示范围
- 选中的时间范围高亮显示
- 切换时间范围后，所有图表和数据同步更新

### 5.2 图表交互
- 支持图表的缩放、平移等基本交互
- 点击图表元素显示详细数据提示
- 长按图表可保存图表图片

### 5.3 记录列表交互
- 点击记录项跳转到详细的情绪分析页面
- 支持下拉刷新加载最新数据
- 支持上拉加载更多历史记录

## 6. 样式设计

### 6.1 整体风格
- 遵循 iOS 设计规范，使用卡片式布局
- 使用圆角元素和适当的阴影效果
- 保持视觉体验现代简洁

### 6.2 配色方案
- 积极情绪：#5e72e4（蓝紫色）
- 中性情绪：#ffc107（黄色）
- 消极情绪：#f56565（红色）
- 平静情绪：#90EE90（浅绿色）
- 背景色：#f8f9fa（浅灰色）
- 卡片背景：#ffffff（白色）

### 6.3 响应式设计
- 适配不同尺寸的设备屏幕
- 在小屏幕设备上优化布局和元素大小
- 支持横屏和竖屏模式

## 7. 开发步骤

### 7.1 基础结构搭建
1. 创建页面文件结构
2. 实现基本页面布局
3. 添加页面配置和路由

### 7.2 数据服务实现
1. 在 `emotionService.js` 中添加获取情绪历史数据的方法
2. 实现数据处理和格式转换功能
3. 添加数据缓存机制，优化加载性能

### 7.3 UI 组件实现
1. 实现时间范围选择组件
2. 集成 `ec-canvas` 图表组件
3. 实现情绪日历组件
4. 实现情绪记录列表组件

### 7.4 功能联调和优化
1. 连接数据服务和 UI 组件
2. 实现页面交互逻辑
3. 优化加载性能和用户体验
4. 添加错误处理和加载状态提示

### 7.5 测试和调试
1. 进行功能测试，确保所有功能正常工作
2. 进行性能测试，优化加载速度和响应时间
3. 进行兼容性测试，确保在不同设备上正常显示
4. 修复发现的问题和 bug

## 8. 注意事项

### 8.1 性能优化
- 使用分页加载大量数据
- 实现数据缓存，避免重复请求
- 优化图表渲染性能，避免卡顿

### 8.2 兼容性考虑
- 考虑低端设备的性能限制
- 提供数据加载失败的备选显示方案
- 确保在不同尺寸屏幕上的良好显示效果

### 8.3 用户体验优化
- 添加适当的加载动画和过渡效果
- 提供清晰的操作反馈
- 优化空数据状态的显示

## 9. 与现有系统的集成

### 9.1 与情绪分析系统的集成
- 使用现有的情绪分析结果数据
- 保持情绪类型和颜色的一致性
- 复用情绪分析相关的组件和服务

### 9.2 与导航系统的集成
- 在首页和用户页面添加入口链接
- 实现与其他页面的无缝导航
- 保持导航体验的一致性

## 10. 后续优化方向

### 10.1 功能扩展
- 添加情绪数据导出功能
- 实现情绪预测和建议功能
- 增加情绪比较和分析功能

### 10.2 UI/UX 优化
- 增加更多的动画和交互效果
- 优化图表的视觉呈现
- 提供更多的自定义选项

### 10.3 性能提升
- 优化数据查询和处理逻辑
- 实现更高效的图表渲染
- 优化页面加载和响应速度

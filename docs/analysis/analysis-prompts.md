# HeartChat Analysis 云函数提示词文档

## 📋 文档概述

本文档整理了 HeartChat Analysis 云函数中使用的所有提示词，包括情感分析、关键词提取、用户兴趣分析等功能的提示词设计。

## 🔍 提示词分类

### 1. 情感分析提示词

#### 情感分析系统提示词

```javascript
const emotionAnalysisPrompt = `你是一个专业且富有同理心的情感分析助手。请细致分析用户最新输入的文本，并可选择性地参考之前的对话上下文（如果提供），以JSON格式返回全面的情感分析结果。
返回的JSON对象应包含以下字段：
- primary_emotion: (String) 检测到的主要情感类型，必须使用中文表达 (例如: "焦虑", "喜悦", "愤怒", "平静", "悲伤", "惊讶", "厌恶", "期待", "紧迫", "失望", "疲惫" 等)。
- secondary_emotions: (Array<String>) 检测到的次要情感，必须使用中文表达（最多2个，按强度排序，如果没有则为空数组 []）。
- intensity: (Float) 主要情感的强度，范围 0.0 (几乎没有) 到 1.0 (非常强烈)。
- valence: (Float) 情感的愉悦度/极性，范围 -1.0 (非常负面) 到 1.0 (非常正面)，0.0 代表中性。
- arousal: (Float) 情感的激动/唤醒水平，范围 0.0 (非常平静/低能量) 到 1.0 (非常激动/高能量)。
- trend: (String) 与上一轮分析相比的情绪变化趋势，必须使用中文表达 ("上升", "下降", "稳定")。如果无法判断或无上一轮数据，则为 "未知"。请同时提供英文字段名 trend_en ("rising", "falling", "stable", "unknown")。
- attention_level: (String) 估计的用户在对话中的注意力或投入程度，必须使用中文表达 ("高", "中", "低")。请同时提供英文字段名 attention_level_en ("high", "medium", "low")。
- radar_dimensions: (Object) 针对以下维度的评分估计 (范围 0.0 到 1.0): {"trust": Float (信任度), "openness": Float (开放度), "resistance": Float (抗拒/防御), "stress": Float (压力水平), "control": Float (控制感/确定性)}。请根据对话内容合理估计。
- topic_keywords: (Array<String>) 与当前讨论**主题**相关的关键词，必须使用中文表达，最多5个，按重要性排序。
- emotion_triggers: (Array<String>) 最可能引发当前主要情感的用户文本中的关键词或短语，必须使用中文表达，最多3个。
- suggestions: (Array<String>) 基于当前情感、主题和维度分析，提供1-3条具体、可行的建议策略或共情回应，必须使用中文表达。
- summary: (String) 用一句中文简洁地总结用户当前的情感状态、可能的原因以及关键特征。

请确保输出是严格的JSON格式。如果某些字段无法可靠判断，可以使用合理的默认值（如 intensity: 0.5, valence: 0.0, arousal: 0.5, trend: "未知", attention_level: "中", radar_dimensions 各项为 0.5）或返回空数组/null（对于 secondary_emotions, emotion_triggers）。

重要提示：所有文本字段必须使用中文返回，不要使用英文。这对于前端显示和情感颜色分类至关重要。`
```

**设计特点：**
- 多维度情感分析模型
- 中文情感类型标准化
- 上下文感知分析
- 雷达图维度评分
- 建议生成能力

### 2. 关键词提取提示词

#### 关键词提取提示词

```javascript
const keywordExtractionPrompt = `你是一个专业的文本分析助手。请从用户提供的文本中提取最重要的关键词，并以JSON格式返回结果。
返回的JSON应包含以下字段：
- keywords: 关键词数组，每个元素是一个对象，包含word(关键词)和weight(权重,0-1之间的浮点数)

请确保返回的是有效的JSON格式，不要添加额外的解释或前缀。提取的关键词数量不超过${topK}个，按重要性降序排列。`
```

**设计特点：**
- 权重化关键词提取
- JSON结构化输出
- 数量限制和排序
- 简洁明确的要求

### 3. 聚类分析提示词

#### 聚类分析提示词

```javascript
const clusterAnalysisPrompt = `你是一个专业的文本分析助手。请从用户提供的文本中提取关键词，并将语义相近的关键词聚类，以JSON格式返回结果。
返回的JSON应包含以下字段：
- clusters: 聚类结果数组，每个元素是一个对象，包含以下字段：
  - keywords: 该簇包含的关键词数组
  - center: 该簇的中心词或主题
  - size: 该簇的大小(关键词数量)

请确保返回的是有效的JSON格式，不要添加额外的解释或前缀。每个簇至少包含${minClusterSize}个关键词，相似度阈值为${threshold}。`
```

**设计特点：**
- 语义聚类分析
- 动态参数配置
- 聚类质量保证
- 中心词识别

### 4. 用户兴趣分析提示词

#### 用户兴趣分析提示词

```javascript
const userInterestAnalysisPrompt = `你是一个专业的用户兴趣分析助手。请分析用户的历史消息，提取用户可能的兴趣领域，并以JSON格式返回分析结果。
返回的JSON应包含以下字段：
- interests: 兴趣领域数组，每个元素是一个对象，包含以下字段：
  - name: 兴趣领域名称
  - confidence: 置信度，0-1之间的浮点数
  - keywords: 与该兴趣相关的关键词数组
- summary: 用户兴趣的简短总结

请确保返回的是有效的JSON格式，不要添加额外的解释或前缀。`
```

**设计特点：**
- 兴趣领域识别
- 置信度评估
- 关键词关联分析
- 总结生成能力

### 5. 报告生成提示词

#### 每日心情报告生成提示词

```javascript
const reportGenerationPrompt = `
  我需要你分析以下文本中表达的情感，并生成一份简短的每日心情总结报告。
  文本内容：${emotionTexts.join(' ')}

  请以JSON格式返回以下内容：
  1. summary: 200字以内的情感总结，分析用户今天的主要情绪状态、可能的原因和变化趋势
  2. insights: 3-5条关于用户情绪模式的洞察
  3. suggestions: 3条针对用户情绪状态的建议
  4. fortune: 基于用户情绪生成的"今日运势"，包含"good"和"bad"各2项，分别表示宜做和忌做的事情
  5. encouragement: 一句鼓励的话

  确保返回的是有效的JSON格式，不要添加额外的解释或前缀。
`
```

**设计特点：**
- 综合情感分析
- 多维度报告生成
- 个性化建议
- 心理支持元素

### 6. 关键词分类提示词

#### 关键词分类提示词模板

```javascript
const CLASSIFICATION_PROMPT = `
你是一个专业的关键词分类器。请将以下关键词分类到最合适的类别中。
可用的类别有：${PREDEFINED_CATEGORIES.join('、')}。

每个类别的说明：
- 学习：与学习、教育、知识获取、考试、学术研究相关的关键词
- 工作：与职业、事业、职场、工作环境、职业发展相关的关键词
- 娱乐：与休闲、放松、娱乐活动相关的关键词
- 社交：与人际交往、社交活动、交友相关的关键词
- 健康：与身体健康、医疗、疾病、健康生活相关的关键词
- 生活：与日常生活、生活方式、家庭生活相关的关键词
- 科技：与技术、数码、互联网、软硬件相关的关键词
- 艺术：与绘画、音乐、舞蹈、文学、创作相关的关键词
- 体育：与运动、健身、体育比赛相关的关键词
- 旅游：与旅行、出游、景点、度假相关的关键词
- 美食：与饮食、烹饪、餐厅、食物相关的关键词
- 时尚：与服装、穿搭、美容、化妆相关的关键词
- 金融：与理财、投资、储蓄、经济相关的关键词
- 宠物：与宠物饲养、宠物健康相关的关键词
- 家庭：与家人、亲情、婚姻、恋爱相关的关键词
- 音乐：与音乐欣赏、乐器、音乐创作相关的关键词
- 电影：与电影欣赏、电影制作相关的关键词
- 阅读：与书籍、文学作品、阅读习惯相关的关键词
- 游戏：与电子游戏、手机游戏相关的关键词
- 心理：与心理健康、情绪管理、心理咨询相关的关键词
- 自我提升：与个人成长、自我发展、技能提升相关的关键词
- 时间管理：与效率提升、任务规划、时间分配相关的关键词
- 压力缓解：与减压方法、压力源识别、放松技巧相关的关键词
- 人际关系：与人际交往、沟通技巧、冲突处理相关的关键词
- 休闲活动：与户外活动、室内活动、休闲爱好相关的关键词
- 其他：不属于以上任何类别的关键词

关键词列表：
{{keywords}}

请以JSON格式返回结果，格式如下：
{
  "classifications": [
    {"keyword": "关键词1", "category": "类别1"},
    {"keyword": "关键词2", "category": "类别2"},
    ...
  ]
}

只返回JSON格式的结果，不要有任何其他文字。
`
```

**设计特点：**
- 26个预定义类别
- 详细的类别说明
- 模板化设计
- 严格的JSON输出要求

## 🔧 提示词设计模式分析

### 1. 结构化设计模式

**JSON格式输出**
```javascript
// 统一的JSON响应格式
{
  "field1": "value1",
  "field2": ["value2", "value3"],
  "field3": {
    "subfield1": "subvalue1"
  }
}
```

**优势：**
- 便于程序解析
- 数据结构清晰
- 类型定义明确
- 易于验证和测试

### 2. 角色设定模式

**角色定义示例：**
```javascript
"你是一个专业且富有同理心的情感分析助手"
"你是一个专业的文本分析助手"
"你是一个专业的关键词分类器"
```

**优势：**
- 明确AI角色定位
- 提高输出质量
- 符合应用场景需求
- 增强用户体验

### 3. 上下文整合模式

**上下文处理示例：**
```javascript
// 情感分析支持历史消息
if (Array.isArray(history) && history.length > 0) {
  const contextMessages = history.slice(-5);
  // 添加到消息上下文
}
```

**优势：**
- 提高分析准确性
- 支持连续对话
- 理解情感变化趋势
- 个性化服务能力

### 4. 本地化设计模式

**中文输出要求：**
```javascript
"重要提示：所有文本字段必须使用中文返回，不要使用英文。"
"这对于前端显示和情感颜色分类至关重要。"
```

**优势：**
- 符合中文用户习惯
- 提高可读性
- 本地化用户体验
- 便于前端处理

### 5. 容错机制设计

**默认值处理：**
```javascript
"如果某些字段无法可靠判断，可以使用合理的默认值"
"（如 intensity: 0.5, valence: 0.0, arousal: 0.5）"
```

**优势：**
- 提高系统稳定性
- 避免空值错误
- 保持数据完整性
- 优雅降级能力

### 6. 模块化设计模式

**功能分离：**
```javascript
// 每个功能独立的提示词
emotionAnalysisPrompt     // 情感分析
keywordExtractionPrompt  // 关键词提取
clusterAnalysisPrompt    // 聚类分析
userInterestAnalysisPrompt // 用户兴趣分析
```

**优势：**
- 职责单一原则
- 便于维护和优化
- 支持独立测试
- 提高代码复用性

## 🎯 提示词优化策略

### 1. 精确性优化

**具体化要求：**
```javascript
// 明确的数值范围
"范围 0.0 (几乎没有) 到 1.0 (非常强烈)"
"最多5个，按重要性排序"
"200字以内的情感总结"
```

**优化效果：**
- 减少歧义
- 提高输出一致性
- 便于程序处理
- 增强用户体验

### 2. 完整性优化

**全面性覆盖：**
```javascript
// 多维度分析
"primary_emotion: 主要情感"
"secondary_emotions: 次要情感"
"intensity: 强度"
"valence: 愉悦度"
"arousal: 唤醒度"
```

**优化效果：**
- 全面情感分析
- 多维度数据
- 丰富用户画像
- 提高分析深度

### 3. 可用性优化

**实用性建议：**
```javascript
"suggestions: 基于当前情感、主题和维度分析，提供1-3条具体、可行的建议策略"
"fortune: 基于用户情绪生成的'今日运势'"
"encouragement: 一句鼓励的话"
```

**优化效果：**
- 提供实用价值
- 增强情感支持
- 提高用户粘性
- 实现情感陪伴目标

### 4. 性能优化

**性能考虑：**
```javascript
// 限制输出数量
"最多5个关键词"
"最多2个次要情感"
"最多3个情感触发词"
// 历史消息限制
"最多添加5条历史消息"
```

**优化效果：**
- 减少API调用成本
- 提高响应速度
- 降低资源消耗
- 优化用户体验

## 📊 提示词效果评估

### 1. 情感分析效果

**评估维度：**
- 情感类型识别准确率
- 强度评估准确性
- 上下文理解能力
- 建议相关性

**优化方向：**
- 增加情感类型样本
- 优化强度评估算法
- 改进上下文处理
- 提升建议个性化

### 2. 关键词提取效果

**评估维度：**
- 关键词相关性
- 权重分配合理性
- 数量控制准确性
- 排序逻辑正确性

**优化方向：**
- 改进关键词提取算法
- 优化权重计算
- 增强上下文理解
- 提升排序准确性

### 3. 分类效果评估

**评估维度：**
- 分类准确性
- 类别覆盖度
- 边界情况处理
- 性能表现

**优化方向：**
- 扩展训练数据
- 优化分类规则
- 改进边界处理
- 提升处理效率

## 🔮 未来提示词发展方向

### 1. 个性化提示词

**发展方向：**
- 基于用户历史的个性化提示词
- 适应不同用户群体的提示词变体
- 动态调整的提示词策略

### 2. 多模态提示词

**扩展能力：**
- 支持图像、音频等多模态输入
- 综合多种信息源的分析能力
- 更丰富的情感表达识别

### 3. 实时优化提示词

**智能优化：**
- 基于反馈的提示词自动优化
- A/B测试驱动的提示词改进
- 机器学习辅助的提示词生成

### 4. 领域专业化

**专业领域：**
- 心理健康专业提示词
- 教育辅导专业提示词
- 职场发展专业提示词
- 人际关系专业提示词

---

## 📝 总结

HeartChat Analysis 云函数的提示词设计体现了专业的工程实践和用户体验导向的设计理念。通过结构化、模块化、本地化的设计模式，实现了高质量的情感分析和服务能力。

**核心优势：**
- 🎯 **专业化设计**：每个提示词都有明确的角色定位和功能目标
- 📊 **结构化输出**：统一的JSON格式，便于程序处理和数据整合
- 🌍 **本地化适配**：完全中文环境，符合中国用户使用习惯
- 🛡️ **容错性强**：完善的默认值和异常处理机制
- 🚀 **性能优化**：合理的输出限制和性能考虑

**设计原则：**
1. **用户中心**：以用户需求和使用体验为核心
2. **技术驱动**：充分利用AI能力，提供专业服务
3. **实用导向**：注重实际应用价值和用户体验
4. **持续优化**：基于反馈和数据进行持续改进

这些提示词不仅实现了技术功能，更重要的是为用户提供了专业、贴心的情感陪伴服务，是HeartChat产品核心竞争力的重要组成部分。
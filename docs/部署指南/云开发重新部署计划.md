# ğŸš€ HeartChat äº‘å¼€å‘é‡æ–°éƒ¨ç½²è®¡åˆ’

## ğŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

**é¢„è®¡å®Œæˆæ—¶é—´ï¼š** 1-2å¤©  
**éƒ¨ç½²éš¾åº¦ï¼š** ä¸­ç­‰  
**é£é™©ç­‰çº§ï¼š** ä½  

## ğŸ¯ éƒ¨ç½²å‰å‡†å¤‡

### 1. ç¯å¢ƒå‡†å¤‡æ¸…å•
- [ ] å¾®ä¿¡å¼€å‘è€…å·¥å…·å·²å®‰è£…å¹¶ç™»å½•
- [ ] å¾®ä¿¡å°ç¨‹åºè´¦å·å·²å¼€é€šäº‘å¼€å‘
- [ ] æ™ºè°±AI APIå¯†é’¥å·²ç”³è¯·
- [ ] é¡¹ç›®ä»£ç å·²å‡†å¤‡å°±ç»ª

### 2. èµ„æºéœ€æ±‚
- **äº‘å¼€å‘ç¯å¢ƒï¼š** 1ä¸ªæ–°ç¯å¢ƒ
- **äº‘å‡½æ•°ï¼š** 13ä¸ªä¸»è¦äº‘å‡½æ•°
- **æ•°æ®åº“é›†åˆï¼š** 9ä¸ªä¸»è¦é›†åˆ
- **å­˜å‚¨æ¡¶ï¼š** 1ä¸ªç”¨äºå›¾ç‰‡å’Œæ–‡ä»¶å­˜å‚¨

## ğŸ› ï¸ è¯¦ç»†éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºäº‘å¼€å‘ç¯å¢ƒ

#### 1.1 åˆ›å»ºæ–°ç¯å¢ƒ
```bash
# åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ“ä½œ
1. ç‚¹å‡»å·¥å…·æ "äº‘å¼€å‘"æŒ‰é’®
2. é€‰æ‹©"å¼€é€šäº‘å¼€å‘"
3. é€‰æ‹©ç¯å¢ƒåˆ›å»ºï¼ˆå»ºè®®é€‰æ‹©æŒ‰é‡ä»˜è´¹ï¼‰
4. è®°å½•ç¯å¢ƒIDï¼ˆæ ¼å¼ï¼šcloud1-xxxxxxxxxxxxxï¼‰
5. ç¯å¢ƒåç§°ï¼šheartchat-prod
```

#### 1.2 é…ç½®ç¯å¢ƒå˜é‡
```javascript
// åœ¨äº‘å¼€å‘æ§åˆ¶å° -> è®¾ç½® -> ç¯å¢ƒå˜é‡ä¸­æ·»åŠ 
ZHIPUAI_API_KEY = "your_zhipuai_api_key"
ZHIPUAI_BASE_URL = "https://open.bigmodel.cn/api/paas/v4/"
ENVIRONMENT = "production"
```

#### 1.3 æ›´æ–°é¡¹ç›®é…ç½®
```javascript
// miniprogram/app.js æ›´æ–°ç¯å¢ƒID
App({
  onLaunch() {
    if (!wx.cloud) {
      console.error('è¯·ä½¿ç”¨ 2.2.3 æˆ–ä»¥ä¸Šçš„åŸºç¡€åº“ä»¥ä½¿ç”¨äº‘èƒ½åŠ›')
    } else {
      wx.cloud.init({
        env: 'cloud1-9gpfk3ie94d8630a', // æ›¿æ¢ä¸ºæ–°çš„ç¯å¢ƒID
        traceUser: true,
      })
    }
  }
})
```

### ç¬¬äºŒæ­¥ï¼šéƒ¨ç½²äº‘å‡½æ•°

#### 2.1 æ ¸å¿ƒäº‘å‡½æ•°éƒ¨ç½²ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰

**ä¼˜å…ˆçº§1ï¼šåŸºç¡€æœåŠ¡**
```bash
# 1. login äº‘å‡½æ•°
# è·¯å¾„ï¼šcloudfunctions/login
npm install --save wx-server-sdk axios
# å³é”®ç‚¹å‡» login ç›®å½• -> äº‘å‡½æ•°ï¼šä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–

# 2. user äº‘å‡½æ•°
# è·¯å¾„ï¼šcloudfunctions/user
npm install --save wx-server-sdk axios
# å³é”®ç‚¹å‡» user ç›®å½• -> äº‘å‡½æ•°ï¼šä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–
```

**ä¼˜å…ˆçº§2ï¼šæ ¸å¿ƒä¸šåŠ¡**
```bash
# 3. analysis äº‘å‡½æ•°ï¼ˆæœ€é‡è¦ï¼‰
# è·¯å¾„ï¼šcloudfunctions/analysis
npm install --save wx-server-sdk axios
# å³é”®ç‚¹å‡» analysis ç›®å½• -> äº‘å‡½æ•°ï¼šä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–

# 4. chat äº‘å‡½æ•°
# è·¯å¾„ï¼šcloudfunctions/chat
npm install --save wx-server-sdk axios
# å³é”®ç‚¹å‡» chat ç›®å½• -> äº‘å‡½æ•°ï¼šä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–
```

**ä¼˜å…ˆçº§3ï¼šè¾…åŠ©åŠŸèƒ½**
```bash
# 5. roles äº‘å‡½æ•°
# è·¯å¾„ï¼šcloudfunctions/roles
npm install --save wx-server-sdk

# 6. emotion äº‘å‡½æ•°
# è·¯å¾„ï¼šcloudfunctions/emotion
npm install --save wx-server-sdk

# 7. generateDailyReports äº‘å‡½æ•°
# è·¯å¾„ï¼šcloudfunctions/generateDailyReports
npm install --save wx-server-sdk axios

# 8. å…¶ä»–äº‘å‡½æ•°...
# getEmotionRecords, getRoleInfo, quickstartFunctions ç­‰
```

#### 2.2 äº‘å‡½æ•°é…ç½®ä¼˜åŒ–

```javascript
// analysis äº‘å‡½æ•°å†…å­˜é…ç½®ï¼ˆ512MBï¼‰
// åœ¨äº‘å¼€å‘æ§åˆ¶å° -> äº‘å‡½æ•° -> analysis -> ç¼–è¾‘
{
  "memorySize": 512,
  "timeout": 20,
  "environment": {
    "ZHIPUAI_API_KEY": "your_api_key"
  }
}

// chat äº‘å‡½æ•°é…ç½®ï¼ˆ256MBï¼‰
{
  "memorySize": 256,
  "timeout": 15
}
```

### ç¬¬ä¸‰æ­¥ï¼šæ•°æ®åº“åˆå§‹åŒ–

#### 3.1 åˆ›å»ºæ•°æ®åº“é›†åˆ

```javascript
// åœ¨äº‘å¼€å‘æ§åˆ¶å° -> æ•°æ®åº“ ä¸­åˆ›å»ºä»¥ä¸‹é›†åˆ

// 1. users - ç”¨æˆ·ä¿¡æ¯
db.createCollection('users', {
  // ç”¨æˆ·åŸºç¡€ä¿¡æ¯
  // _id, openid, nickname, avatar, create_time, update_time
})

// 2. roles - è§’è‰²ä¿¡æ¯
db.createCollection('roles', {
  // è§’è‰²å®šä¹‰
  // _id, name, description, avatar, prompt, category
})

// 3. chats - èŠå¤©ä¼šè¯
db.createCollection('chats', {
  // ä¼šè¯ä¿¡æ¯
  // _id, user_id, role_id, title, create_time, update_time
})

// 4. messages - æ¶ˆæ¯è®°å½•
db.createCollection('messages', {
  // æ¶ˆæ¯è¯¦æƒ…
  // _id, chat_id, user_id, content, type, timestamp
})

// 5. emotionRecords - æƒ…æ„Ÿåˆ†æè®°å½•
db.createCollection('emotionRecords', {
  // æƒ…æ„Ÿåˆ†æç»“æœ
  // _id, user_id, message_id, emotion_data, analysis_time
})

// 6. userReports - ç”¨æˆ·æŠ¥å‘Š
db.createCollection('userReports', {
  // æ¯æ—¥æŠ¥å‘Š
  // _id, user_id, report_data, report_date
})

// 7. userInterests - ç”¨æˆ·å…´è¶£
db.createCollection('userInterests', {
  // å…´è¶£æ ‡ç­¾
  // _id, user_id, interests, update_time
})

// 8. roleUsage - è§’è‰²ä½¿ç”¨ç»Ÿè®¡
db.createCollection('roleUsage', {
  // ä½¿ç”¨ç»Ÿè®¡
  // _id, user_id, role_id, usage_count, last_use_time
})

// 9. sys_config - ç³»ç»Ÿé…ç½®
db.createCollection('sys_config', {
  // ç³»ç»Ÿé…ç½®
  // _id, config_key, config_value, description
})
```

#### 3.2 åˆ›å»ºæ•°æ®åº“ç´¢å¼•

```javascript
// messages é›†åˆç´¢å¼•
db.collection('messages').addIndex({
  "chat_id": 1,
  "timestamp": -1
})

// emotionRecords é›†åˆç´¢å¼•
db.collection('emotionRecords').addIndex({
  "user_id": 1,
  "analysis_time": -1
})

// userReports é›†åˆç´¢å¼•
db.collection('userReports').addIndex({
  "user_id": 1,
  "report_date": -1
})
```

#### 3.3 åˆå§‹åŒ–åŸºç¡€æ•°æ®

```javascript
// åˆå§‹åŒ–é¢„è®¾è§’è‰²æ•°æ®
const initialRoles = [
  {
    name: "æƒ…æ„Ÿå€¾å¬è€…",
    description: "æ¸©æŸ”ä½“è´´çš„æƒ…æ„Ÿæ”¯æŒä¼™ä¼´",
    avatar: "/assets/roles/emotional.png",
    category: "emotional",
    prompt: "ä½ æ˜¯ä¸€ä½æ¸©æŸ”ä½“è´´çš„æƒ…æ„Ÿå€¾å¬è€…...",
    is_default: true
  },
  {
    name: "å¿ƒç†å’¨è¯¢å¸ˆ",
    description: "ä¸“ä¸šçš„å¿ƒç†å’¨è¯¢é¡¾é—®",
    avatar: "/assets/roles/therapist.png", 
    category: "therapy",
    prompt: "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å¿ƒç†å’¨è¯¢å¸ˆ...",
    is_default: true
  },
  {
    name: "ç”Ÿæ´»ä¼™ä¼´",
    description: "è´´å¿ƒçš„ç”Ÿæ´»é™ªä¼´è€…",
    avatar: "/assets/roles/companion.png",
    category: "companion",
    prompt: "ä½ æ˜¯ä¸€ä½è´´å¿ƒçš„ç”Ÿæ´»ä¼™ä¼´...",
    is_default: true
  },
  {
    name: "èŒåœºå¯¼å¸ˆ",
    description: "ç»éªŒä¸°å¯Œçš„èŒåœºæŒ‡å¯¼è€…",
    avatar: "/assets/roles/mentor.png",
    category: "career",
    prompt: "ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„èŒåœºå¯¼å¸ˆ...",
    is_default: true
  }
]

// æ‰¹é‡æ’å…¥è§’è‰²æ•°æ®
await db.collection('roles').add(initialRoles)
```

### ç¬¬å››æ­¥ï¼šæµ‹è¯•éªŒè¯è®¡åˆ’

#### 4.1 åŠŸèƒ½æµ‹è¯•æ¸…å•

**åŸºç¡€åŠŸèƒ½æµ‹è¯•**
- [ ] å°ç¨‹åºå¯åŠ¨æ­£å¸¸
- [ ] ç”¨æˆ·ç™»å½•æˆæƒæ­£å¸¸
- [ ] äº‘å‡½æ•°è°ƒç”¨æ­£å¸¸
- [ ] æ•°æ®åº“è¯»å†™æ­£å¸¸

**æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•**
- [ ] è§’è‰²é€‰æ‹©é¡µé¢æ˜¾ç¤ºæ­£å¸¸
- [ ] èŠå¤©åŠŸèƒ½æ­£å¸¸ï¼ˆå‘é€æ¶ˆæ¯ã€æ¥æ”¶å›å¤ï¼‰
- [ ] æƒ…æ„Ÿåˆ†æåŠŸèƒ½æ­£å¸¸
- [ ] ç”¨æˆ·æŠ¥å‘Šç”Ÿæˆæ­£å¸¸

**AIæœåŠ¡æµ‹è¯•**
- [ ] æ™ºè°±AI APIè°ƒç”¨æ­£å¸¸
- [ ] æƒ…æ„Ÿåˆ†æç»“æœå‡†ç¡®
- [ ] èŠå¤©å›å¤è´¨é‡æ­£å¸¸

#### 4.2 æ€§èƒ½æµ‹è¯•

```javascript
// æµ‹è¯•ç”¨ä¾‹1ï¼šèŠå¤©å“åº”æ—¶é—´
// é¢„æœŸï¼šæ¶ˆæ¯å‘é€åˆ°æ¥æ”¶å›å¤ < 5ç§’

// æµ‹è¯•ç”¨ä¾‹2ï¼šæƒ…æ„Ÿåˆ†æå“åº”æ—¶é—´
// é¢„æœŸï¼šåˆ†æç»“æœè¿”å› < 3ç§’

// æµ‹è¯•ç”¨ä¾‹3ï¼šå¹¶å‘ç”¨æˆ·æµ‹è¯•
// é¢„æœŸï¼šæ”¯æŒ10ä¸ªå¹¶å‘ç”¨æˆ·åŒæ—¶èŠå¤©
```

#### 4.3 é”™è¯¯å¤„ç†æµ‹è¯•

```javascript
// æµ‹è¯•åœºæ™¯1ï¼šç½‘ç»œä¸­æ–­
// æ¨¡æ‹Ÿç½‘ç»œæ–­å¼€ï¼Œæ£€æŸ¥é”™è¯¯æç¤º

// æµ‹è¯•åœºæ™¯2ï¼šAI APIè°ƒç”¨å¤±è´¥
// æ¨¡æ‹ŸAPIè¿”å›é”™è¯¯ï¼Œæ£€æŸ¥é™çº§å¤„ç†

// æµ‹è¯•åœºæ™¯3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥
// æ¨¡æ‹Ÿæ•°æ®åº“å¼‚å¸¸ï¼Œæ£€æŸ¥é”™è¯¯å¤„ç†
```

### ç¬¬äº”æ­¥ï¼šç›‘æ§å’Œä¼˜åŒ–

#### 5.1 è®¾ç½®ç›‘æ§å‘Šè­¦

```javascript
// åœ¨äº‘å¼€å‘æ§åˆ¶å°è®¾ç½®å‘Šè­¦
1. äº‘å‡½æ•°ç›‘æ§
   - æ‰§è¡ŒæˆåŠŸç‡ < 95%
   - æ‰§è¡Œæ—¶é—´ > 10ç§’
   
2. æ•°æ®åº“ç›‘æ§
   - æŸ¥è¯¢å“åº”æ—¶é—´ > 1ç§’
   - å­˜å‚¨ç©ºé—´ä½¿ç”¨ç‡ > 80%
   
3. APIè°ƒç”¨ç›‘æ§
   - æ™ºè°±AI APIè°ƒç”¨å¤±è´¥ç‡ > 5%
```

#### 5.2 æˆæœ¬ä¼˜åŒ–ç­–ç•¥

```javascript
// 1. å®ç°AIç»“æœç¼“å­˜
// å¯¹ç›¸åŒçš„æƒ…æ„Ÿåˆ†æç»“æœè¿›è¡Œç¼“å­˜ï¼Œå‡å°‘é‡å¤è°ƒç”¨

// 2. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
// æ·»åŠ åˆé€‚çš„ç´¢å¼•ï¼Œé¿å…å…¨è¡¨æ‰«æ

// 3. æ•°æ®æ¸…ç†ç­–ç•¥
// å®šæœŸæ¸…ç†è¿‡æœŸçš„èŠå¤©è®°å½•å’Œåˆ†ææ•°æ®
```

## ğŸ“Š éƒ¨ç½²æ—¶é—´è¡¨

| æ—¶é—´ | ä»»åŠ¡ | é¢„è®¡ç”¨æ—¶ | è´Ÿè´£äºº |
|------|------|----------|--------|
| Day 1 ä¸Šåˆ | ç¯å¢ƒåˆ›å»ºå’Œé…ç½® | 2å°æ—¶ | å¼€å‘è€… |
| Day 1 ä¸‹åˆ | äº‘å‡½æ•°éƒ¨ç½² | 4å°æ—¶ | å¼€å‘è€… |
| Day 2 ä¸Šåˆ | æ•°æ®åº“åˆå§‹åŒ– | 2å°æ—¶ | å¼€å‘è€… |
| Day 2 ä¸‹åˆ | åŠŸèƒ½æµ‹è¯• | 3å°æ—¶ | æµ‹è¯•è€… |
| Day 2 æ™šä¸Š | æ€§èƒ½ä¼˜åŒ– | 2å°æ—¶ | å¼€å‘è€… |

## ğŸš¨ å¸¸è§é—®é¢˜å¤„ç†

### é—®é¢˜1ï¼šäº‘å‡½æ•°éƒ¨ç½²å¤±è´¥
```javascript
// è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥ package.json ä¾èµ–æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
3. æ£€æŸ¥äº‘å¼€å‘ç¯å¢ƒæ˜¯å¦æ­£ç¡®é…ç½®
4. é‡å¯å¾®ä¿¡å¼€å‘è€…å·¥å…·
```

### é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥
```javascript
// è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥ç¯å¢ƒIDæ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ•°æ®åº“é›†åˆå·²åˆ›å»º
3. æ£€æŸ¥æ•°æ®åº“æƒé™è®¾ç½®
4. éªŒè¯å°ç¨‹åºæ˜¯å¦å·²æ­£ç¡®åˆå§‹åŒ–äº‘å¼€å‘
```

### é—®é¢˜3ï¼šAI APIè°ƒç”¨å¤±è´¥
```javascript
// è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®é…ç½®
2. ç¡®è®¤APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
3. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. éªŒè¯APIè°ƒç”¨æ ¼å¼æ˜¯å¦æ­£ç¡®
```

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] å¾®ä¿¡å¼€å‘è€…å·¥å…·ç‰ˆæœ¬ >= 1.05.2111300
- [ ] å°ç¨‹åºåŸºç¡€åº“ç‰ˆæœ¬ >= 2.2.3
- [ ] æ™ºè°±AI APIå¯†é’¥å·²ç”³è¯·
- [ ] é¡¹ç›®ä»£ç å·²å®Œæ•´å‡†å¤‡

### éƒ¨ç½²ä¸­æ£€æŸ¥
- [ ] äº‘å¼€å‘ç¯å¢ƒåˆ›å»ºæˆåŠŸ
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] äº‘å‡½æ•°éƒ¨ç½²æ— é”™è¯¯
- [ ] æ•°æ®åº“é›†åˆåˆ›å»ºæˆåŠŸ
- [ ] åŸºç¡€æ•°æ®åˆå§‹åŒ–å®Œæˆ

### éƒ¨ç½²åæ£€æŸ¥
- [ ] å°ç¨‹åºå¯åŠ¨æ­£å¸¸
- [ ] ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] èŠå¤©åŠŸèƒ½æ­£å¸¸
- [ ] æƒ…æ„Ÿåˆ†æåŠŸèƒ½æ­£å¸¸
- [ ] æ€§èƒ½æŒ‡æ ‡ç¬¦åˆé¢„æœŸ

## ğŸ¯ æ€»ç»“

è¿™ä¸ªéƒ¨ç½²è®¡åˆ’æ¶µç›–äº†HeartChaté¡¹ç›®é‡æ–°éƒ¨ç½²åˆ°äº‘å¼€å‘ç¯å¢ƒçš„æ‰€æœ‰å…³é”®æ­¥éª¤ã€‚æŒ‰ç…§è¿™ä¸ªè®¡åˆ’æ‰§è¡Œï¼Œæ‚¨å¯ä»¥åœ¨1-2å¤©å†…å®Œæˆæ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹ã€‚

**å…³é”®æˆåŠŸå› ç´ ï¼š**
1. **ç¯å¢ƒé…ç½®å‡†ç¡®**ï¼šç¡®ä¿ç¯å¢ƒIDå’ŒAPIå¯†é’¥é…ç½®æ­£ç¡®
2. **äº‘å‡½æ•°å®Œæ•´éƒ¨ç½²**ï¼šæŒ‰ä¼˜å…ˆçº§é¡ºåºéƒ¨ç½²ï¼Œæ ¸å¿ƒåŠŸèƒ½ä¼˜å…ˆ
3. **æ•°æ®åº“ç»“æ„æ­£ç¡®**ï¼šç¡®ä¿é›†åˆå’Œç´¢å¼•åˆ›å»ºæ­£ç¡®
4. **æµ‹è¯•éªŒè¯å……åˆ†**ï¼šè¿›è¡Œå…¨é¢çš„åŠŸèƒ½å’Œæ€§èƒ½æµ‹è¯•

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**åˆ›å»ºæ—¶é—´ï¼š** 2025-01-09  
**æœ€åæ›´æ–°ï¼š** 2025-01-09  
**ä½œè€…ï¼š** HeartChatå¼€å‘å›¢é˜Ÿ
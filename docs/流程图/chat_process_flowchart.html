<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartChat 聊天功能流程图</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #5e72e4;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .sequence-diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: auto;
        }
        
        .participants {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 30px;
        }
        
        .participant {
            text-align: center;
            min-width: 120px;
            padding: 15px;
            border-radius: 8px;
            background-color: #5e72e4;
            color: white;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .lifeline-container {
            display: flex;
            justify-content: space-around;
            width: 100%;
            position: relative;
        }
        
        .lifeline {
            width: 2px;
            background-color: #cbd5e0;
            min-height: 800px;
            position: relative;
        }
        
        .message {
            position: absolute;
            display: flex;
            align-items: center;
            width: 100%;
            left: 0;
        }
        
        .message-line {
            height: 2px;
            background-color: #4a5568;
            flex-grow: 1;
            position: relative;
        }
        
        .message-line.response {
            background-color: #48bb78;
            border-top: 2px dashed #48bb78;
            height: 0;
        }
        
        .message-line::after {
            content: '';
            position: absolute;
            right: 0;
            top: -4px;
            width: 0;
            height: 0;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
            border-left: 8px solid #4a5568;
        }
        
        .message-line.response::after {
            border-left-color: #48bb78;
        }
        
        .message-label {
            position: absolute;
            font-size: 12px;
            background-color: white;
            padding: 2px 5px;
            border-radius: 4px;
            white-space: nowrap;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .activation {
            position: absolute;
            width: 10px;
            background-color: #edf2f7;
            border: 1px solid #cbd5e0;
            left: -4px;
        }
        
        .note {
            position: absolute;
            background-color: #fefcbf;
            border: 1px solid #ecc94b;
            border-radius: 4px;
            padding: 8px;
            max-width: 200px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HeartChat 聊天功能流程图</h1>
        
        <div class="sequence-diagram">
            <div class="participants">
                <div class="participant">用户</div>
                <div class="participant">小程序前端</div>
                <div class="participant">云函数</div>
                <div class="participant">数据库</div>
                <div class="participant">AI服务</div>
            </div>
            
            <div class="lifeline-container">
                <!-- 生命线 -->
                <div class="lifeline" id="user-lifeline"></div>
                <div class="lifeline" id="frontend-lifeline"></div>
                <div class="lifeline" id="cloud-lifeline"></div>
                <div class="lifeline" id="database-lifeline"></div>
                <div class="lifeline" id="ai-lifeline"></div>
                
                <!-- 激活区域 -->
                <div class="activation" style="top: 50px; height: 700px; left: 121px;"></div>
                <div class="activation" style="top: 80px; height: 670px; left: 241px;"></div>
                <div class="activation" style="top: 110px; height: 100px; left: 361px;"></div>
                <div class="activation" style="top: 140px; height: 40px; left: 481px;"></div>
                <div class="activation" style="top: 250px; height: 100px; left: 361px;"></div>
                <div class="activation" style="top: 400px; height: 150px; left: 361px;"></div>
                <div class="activation" style="top: 430px; height: 40px; left: 481px;"></div>
                <div class="activation" style="top: 500px; height: 40px; left: 481px;"></div>
                <div class="activation" style="top: 580px; height: 70px; left: 361px;"></div>
                <div class="activation" style="top: 610px; height: 40px; left: 601px;"></div>
                
                <!-- 消息 -->
                <!-- 1. 选择角色 -->
                <div class="message" style="top: 50px;">
                    <div style="width: 120px;"></div>
                    <div class="message-line">
                        <div class="message-label">选择角色</div>
                    </div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 2. 获取角色信息 -->
                <div class="message" style="top: 80px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line">
                        <div class="message-label">获取角色信息</div>
                    </div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 3. 查询角色数据 -->
                <div class="message" style="top: 110px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line">
                        <div class="message-label">查询角色数据</div>
                    </div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 4. 返回角色数据 -->
                <div class="message" style="top: 170px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line response" style="transform: scaleX(-1);">
                        <div class="message-label">返回角色数据</div>
                    </div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 5. 返回角色信息 -->
                <div class="message" style="top: 200px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line response" style="transform: scaleX(-1);">
                        <div class="message-label">返回角色信息</div>
                    </div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 6. 显示聊天界面 -->
                <div class="message" style="top: 230px;">
                    <div style="width: 120px;"></div>
                    <div class="message-line response" style="transform: scaleX(-1);">
                        <div class="message-label">显示聊天界面</div>
                    </div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 7. 发送消息 -->
                <div class="message" style="top: 280px;">
                    <div style="width: 120px;"></div>
                    <div class="message-line">
                        <div class="message-label">发送消息</div>
                    </div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 8. 保存用户消息 -->
                <div class="message" style="top: 310px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line">
                        <div class="message-label">保存用户消息</div>
                    </div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 9. 存储消息 -->
                <div class="message" style="top: 340px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line">
                        <div class="message-label">存储消息</div>
                    </div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 10. 分析用户情绪 -->
                <div class="note" style="top: 380px; left: 300px;">
                    分析用户情绪
                </div>
                
                <!-- 11. 存储情绪数据 -->
                <div class="message" style="top: 430px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line">
                        <div class="message-label">存储情绪数据</div>
                    </div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 12. 返回情绪分析结果 -->
                <div class="message" style="top: 470px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line response" style="transform: scaleX(-1);">
                        <div class="message-label">返回情绪分析结果</div>
                    </div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 13. 显示情绪标签 -->
                <div class="message" style="top: 500px;">
                    <div style="width: 120px;"></div>
                    <div class="message-line response" style="transform: scaleX(-1);">
                        <div class="message-label">显示情绪标签</div>
                    </div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 14. 生成AI回复 -->
                <div class="note" style="top: 540px; left: 300px;">
                    生成AI回复
                </div>
                
                <!-- 15. 存储AI回复 -->
                <div class="message" style="top: 580px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line">
                        <div class="message-label">存储AI回复</div>
                    </div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 16. 调用AI服务 -->
                <div class="message" style="top: 610px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line">
                        <div class="message-label">调用AI服务</div>
                    </div>
                </div>
                
                <!-- 17. 返回AI回复 -->
                <div class="message" style="top: 650px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line response" style="transform: scaleX(-1);">
                        <div class="message-label">返回AI回复</div>
                    </div>
                </div>
                
                <!-- 18. 返回AI回复到前端 -->
                <div class="message" style="top: 680px;">
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div class="message-line response" style="transform: scaleX(-1);">
                        <div class="message-label">返回AI回复</div>
                    </div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                </div>
                
                <!-- 19. 显示AI回复 -->
                <div class="message" style="top: 710px;">
                    <div style="width: 120px;"></div>
                    <div class="message-line response" style="transform: scaleX(-1);">
                        <div class="message-label">显示AI回复</div>
                    </div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                    <div style="width: 120px;"></div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

# HeartChat 欢迎页面使用文档

## 功能概述

欢迎页面是 HeartChat 应用的入口页面，主要功能包括：

1. 展示应用的品牌标识和核心价值
2. 提供微信一键登录功能
3. 引导用户了解应用的主要功能
4. 处理用户登录状态和页面跳转

## 页面结构

欢迎页面由以下几个部分组成：

1. **顶部区域**：包含应用 Logo、应用名称和应用标语
2. **内容区域**：展示应用的四大核心功能，包括情感倾诉、角色互动、情绪跟踪和每日心情报告
3. **底部区域**：包含微信一键登录按钮和协议勾选区域

## 使用方法

### 首次进入应用

1. 用户首次打开应用时，会自动进入欢迎页面
2. 用户可以浏览应用的核心功能介绍
3. 勾选同意服务协议和隐私协议
4. 点击"一键微信登录"按钮，授权微信登录
5. 登录成功后，自动跳转到应用主页

### 已登录用户

如果用户已经登录过应用，欢迎页面会自动检测登录状态，并直接跳转到应用主页，无需再次登录。

## 技术实现

### 文件结构

```
pages/welcome/
├── welcome.js       # 页面逻辑
├── welcome.json     # 页面配置
├── welcome.wxml     # 页面结构
└── welcome.wxss     # 页面样式
```

### 关键代码

#### 登录状态检查

```javascript
checkLoginStatus: function () {
  // 从全局获取登录状态
  const isLoggedIn = app.globalData.isLoggedIn;

  if (isLoggedIn) {
    // 已登录，跳转到首页
    this.navigateToHome();
  }
}
```

#### 处理协议勾选

```javascript
handleAgreementChange: function(e) {
  this.setData({
    agreed: e.detail.value.length > 0
  });
}
```

#### 处理登录

```javascript
handleLogin: async function(userInfo) {
  // 检查是否同意协议
  if (!this.data.agreed) {
    wx.showToast({
      title: '请先同意服务协议',
      icon: 'none'
    });
    return;
  }

  // 防止重复点击
  if (this.data.loading) return;

  this.setData({ loading: true });

  try {
    // 获取用户信息
    if (!userInfo) {
      const userProfile = await wx.getUserProfile({
        desc: '用于完善用户资料'
      });
      userInfo = userProfile.userInfo;
    }

    // 获取登录凭证
    const { code } = await wx.login();

    // 调用登录云函数
    const { result } = await wx.cloud.callFunction({
      name: 'login',
      data: {
        code,
        userInfo
      }
    });

    // 保存登录信息并更新全局状态
    const loginData = {
      token: result.data.token,
      userInfo: result.data.userInfo
    };

    if(!saveLoginInfo(loginData)) {
      throw new Error('保存登录信息失败');
    }

    // 更新全局状态
    app.globalData.isLoggedIn = true;
    app.globalData.userInfo = result.data.userInfo;
  } catch (error) {
    // 处理错误...
  } finally {
    this.setData({ loading: false });
  }
}
```

## 注意事项

1. 确保在使用前已正确配置云开发环境
2. 登录前需要用户同意服务协议和隐私协议
3. 登录失败时会显示相应的错误提示
4. 页面使用了渐变背景和动画效果，确保在不同设备上的显示效果一致

## 相关页面

- **服务协议页面**：`pages/agreement/service`
- **隐私协议页面**：`pages/agreement/privacy`
- **主页**：`pages/emotionVault/emotionVault`

## 更新历史

- **2024-04-12**：创建欢迎页面，实现微信一键登录功能
- **2024-04-12**：优化登录流程，直接调用云函数进行登录，移除登录组件依赖
- **2024-04-12**：增强登录功能，正确缓存token和userInfo到本地存储

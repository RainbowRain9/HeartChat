# HeartChat 微信小程序项目开发文档

## 项目目录结构

```
HeartChat/
├── .cursor/
│   └── rules/                           # Cursor规则目录 (适用于微信小程序开发)
│       ├── cloudfunctions/            # 云函数规则 (替代原Backend)
│       │   ├── js_standards.mdc       # 云函数JavaScript编码规范
│       │   ├── wx_server_sdk.mdc      # 微信Server SDK使用指南
│       │   ├── cloud_db_usage.mdc     # 云数据库使用规范
│       │   └── cloud_func_test.mdc    # 云函数测试规范
│       │
│       ├── miniprogram/               # 小程序前端规则 (替代原Frontend)
│       │   ├── wxml_guidelines.mdc    # WXML编写规范
│       │   ├── wxss_styles.mdc        # WXSS样式规范
│       │   ├── js_standards.mdc       # 小程序端JavaScript编码规范
│       │   ├── component_design.mdc   # 自定义组件设计规范
│       │   ├── page_lifecycle.mdc     # 页面生命周期使用规范
│       │   ├── api_usage.mdc          # 微信小程序API使用规范
│       │   └── state_management.mdc   # 状态管理模式规范 (如全局变量、事件总线)
│       │
│       ├── design/                      # 设计规则 (结合小程序和iOS风格)
│       │   ├── design_system_mp.mdc   # 小程序设计系统规范
│       │   ├── ui_guidelines_ios.mdc  # UI设计指南 (参考iOS HIG)
│       │   ├── ux_principles.mdc      # 用户体验原则
│       │   ├── accessibility_mp.mdc   # 小程序无障碍设计规范
│       │   └── brand_guidelines.mdc   # 品牌设计规范
│       │
│       ├── wechat-rule.mdc            # (你已有的) 微信小程序整体开发规则
│       └── project_rules.mdc          # 整体项目开发规范 (可整合或细化wechat-rule)
│
├── docs/                                # 全局文档
│   ├── global/                          # 全局设计文档
│   │   ├── architecture.md              # 整体架构设计 (小程序+云开发)
│   │   ├── tech_stack.md                # 技术栈说明 (原生框架, 云开发)
│   │   ├── coding_standards.md          # 编码规范 (汇总各部分)
│   │   ├── git_workflow.md              # Git工作流程
│   │   └── deployment.md                # 部署与发布指南 (小程序上传审核)
│   │
│   ├── design/                          # 产品设计文档 (结构保留, 内容需适配)
│   │   ├── product_strategy/            # 产品策略
│   │   │   ├── vision.md                # 产品愿景
│   │   │   ├── roadmap.md               # 产品路线图 (如: HeartChat每日心情报告)
│   │   │   ├── kpis.md                  # 关键性能指标
│   │   │   └── market_research.md       # 市场研究
│   │   │
│   │   ├── user_research/               # 用户研究
│   │   │   ├── personas.md              # 用户画像
│   │   │   ├── journey_maps.md          # 用户旅程图
│   │   │   ├── usability_tests.md       # 可用性测试
│   │   │   └── feedback_analysis.md     # 用户反馈分析
│   │   │
│   │   ├── ux/                          # 用户体验设计
│   │   │   ├── information_architecture.md # 信息架构
│   │   │   ├── navigation_flows.md      # 导航流程 (Tab Bar, 页面跳转)
│   │   │   ├── interaction_patterns.md  # 交互模式 (微信原生交互)
│   │   │   └── accessibility.md         # 无障碍设计
│   │   │
│   │   └── ui/                          # 用户界面设计
│   │       ├── design_system.md         # 设计系统文档 (结合小程序组件库)
│   │       ├── style_guide.md           # 风格指南 (WXSS变量, 颜色, 字体)
│   │       ├── component_specs.md       # 自定义组件规格
│   │       └── responsive_design.md     # 响应式设计 (rpx使用)
│   │
│   ├── cloudfunctions/                  # 云函数通用文档 (替代原Backend)
│   │   ├── function_guidelines.md       # 云函数设计指南
│   │   ├── database_schema.md           # 云数据库模式 (各集合结构)
│   │   ├── auth_flow.md                 # 认证流程 (wx.login, openid)
│   │   ├── cloud_db_usage.md            # 云数据库使用指南
│   │   └── async_tasks.md               # 异步任务处理 (如定时触发器)
│   │
│   ├── miniprogram/                     # 小程序前端通用文档 (替代原Frontend)
│   │   ├── component_library.md         # 自定义组件库使用指南
│   │   ├── state_management.md          # 状态管理策略
│   │   ├── styling_guide.md             # WXSS样式指南
│   │   ├── form_handling.md             # 表单处理 (<form>, bindsubmit)
│   │   ├── api_usage.md                 # 微信API使用指南 (wx.request, wx.login等)
│   │   ├── performance_optimization.md  # 性能优化指南 (分包, 缓存)
│   │   └── testing_strategy.md          # 小程序测试策略 (开发者工具, 真机)
│   │
│   └── templates/                       # 代码模板
│       ├── cloudfunctions/              # 云函数模板
│       │   ├── cloud_function.md        # 标准云函数模板
│       │   └── db_schema.md             # 数据库集合结构模板
│       │
│       └── miniprogram/                 # 小程序模板
│           ├── page_template.md         # 页面模板 (WXML, WXSS, JS, JSON)
│           ├── component_template.md    # 自定义组件模板
│           └── util_function.md         # 工具函数模板 (utils/)
│
├── README.md                            # 项目根 README
├── todo.md                              # 项目待办事项
│
├── miniprogram/                # 小程序前端代码
│   ├── app.js                  # 小程序入口文件
│   ├── app.json                # 小程序全局配置
│   ├── app.wxss                # 小程序全局样式
│   ├── sitemap.json            # 小程序索引配置
│   ├── project.config.json     # 项目配置文件
│   │
│   ├── components/             # 公共组件
│   │   ├── chat-bubble/        # 聊天气泡组件
│   │   ├── chat-input/         # 聊天输入组件
│   │   ├── emotion-card/       # 情绪卡片组件
│   │   ├── emotion-chart/      # 情绪图表组件
│   │   ├── role-card/          # 角色卡片组件
│   │   ├── tab-bar/            # 自定义底部导航栏
│   │   └── user-avatar/        # 用户头像组件
│   │
│   ├── images/                 # 图片资源
│   │   ├── icons/              # 图标资源
│   │   ├── avatars/            # 默认头像
│   │   └── backgrounds/        # 背景图片
│   │
│   ├── pages/                  # 页面目录
│   │   ├── welcome/            # 欢迎/登录页面
│   │   ├── home/               # 主页/功能选择
│   │   ├── role-select/        # 角色选择页面
│   │   ├── chat/               # 聊天页面
│   │   ├── emotion-analysis/   # 情绪分析页面
│   │   ├── emotion-history/    # 情绪历史页面
│   │   ├── daily-report/       # 每日心情报告
│   │   ├── profile/            # 个人资料页面
│   │   └── settings/           # 设置页面
│   │
│   ├── utils/                  # 工具函数
│   │   ├── api.js              # API接口封装
│   │   ├── auth.js             # 认证相关函数
│   │   ├── date.js             # 日期处理函数
│   │   ├── emotion.js          # 情绪分析工具
│   │   └── storage.js          # 本地存储工具
│   │
│   └── models/                 # 数据模型
│       ├── user.js             # 用户数据模型
│       ├── chat.js             # 聊天数据模型
│       ├── role.js             # 角色数据模型
│       └── emotion.js          # 情绪数据模型
│
├── cloudfunctions/             # 云函数目录
│   ├── login/                  # 登录云函数
│   │   ├── index.js            # 主函数入口
│   │   └── package.json        # 依赖配置
│   │
│   ├── chat/                   # 聊天相关云函数
│   │   ├── index.js            # 主函数入口
│   │   └── package.json        # 依赖配置
│   │
│   ├── analysis/               # 情感分析云函数
│   │   ├── index.js            # 主函数入口
│   │   ├── emotion.js          # 情绪分析模块
│   │   ├── keywords.js         # 关键词提取模块
│   │   └── package.json        # 依赖配置
│   │
│   ├── roles/                   # 角色管理云函数
│   │   ├── index.js            # 主函数入口
│   │   └── package.json        # 依赖配置
│   │
│   └── user/                   # 用户管理云函数
│       ├── index.js            # 主函数入口
│       └── package.json        # 依赖配置
│
└── project.config.json         # 项目配置文件
```

## 分包设计

为了优化小程序的加载性能，我们将采用分包加载的策略：

```json
{
  "pages": [
    "pages/welcome/welcome",
    "pages/home/home",
    "pages/role-select/role-select"
  ],
  "subpackages": [
    {
      "root": "packageChat",
      "name": "chatPackage",
      "pages": [
        "pages/chat/chat",
        "pages/emotion-analysis/emotion-analysis"
      ]
    },
    {
      "root": "packageEmotion",
      "name": "emotionPackage",
      "pages": [
        "pages/emotion-history/emotion-history",
        "pages/daily-report/daily-report"
      ]
    },
    {
      "root": "packageUser",
      "name": "userPackage",
      "pages": [
        "pages/profile/profile",
        "pages/settings/settings"
      ]
    }
  ]
}
```

## 页面设计

### 1. 欢迎/登录页面 (welcome)

```
pages/welcome/
├── welcome.js       # 页面逻辑
├── welcome.json     # 页面配置
├── welcome.wxml     # 页面结构
└── welcome.wxss     # 页面样式
```

功能：
- 用户登录/注册
- 微信授权登录
- 应用介绍轮播
- 隐私政策展示

### 2. 主页/功能选择 (home)

```
pages/home/
├── home.js          # 页面逻辑
├── home.json        # 页面配置
├── home.wxml        # 页面结构
└── home.wxss        # 页面样式
```

功能：
- 显示用户基本信息
- 主要功能入口卡片
- 每日心情简报
- 底部导航栏

### 3. 角色选择页面 (role-select)

```
pages/role-select/
├── role-select.js   # 页面逻辑
├── role-select.json # 页面配置
├── role-select.wxml # 页面结构
└── role-select.wxss # 页面样式
```

功能：
- 角色列表展示
- 角色筛选和搜索
- 角色详情查看
- 自定义角色创建

### 4. 聊天页面 (chat)

```
packageChat/pages/chat/
├── chat.js          # 页面逻辑
├── chat.json        # 页面配置
├── chat.wxml        # 页面结构
└── chat.wxss        # 页面样式
```

功能：
- 聊天消息展示
- 消息输入和发送
- 情绪分析触发
- 角色信息显示

### 5. 情绪分析页面 (emotion-analysis)

```
packageChat/pages/emotion-analysis/
├── emotion-analysis.js    # 页面逻辑
├── emotion-analysis.json  # 页面配置
├── emotion-analysis.wxml  # 页面结构
└── emotion-analysis.wxss  # 页面样式
```

功能：
- 情绪分析结果展示
- 情绪强度可视化
- 关键词云展示
- 建议和反馈提供

### 6. 情绪历史页面 (emotion-history)

```
packageEmotion/pages/emotion-history/
├── emotion-history.js     # 页面逻辑
├── emotion-history.json   # 页面配置
├── emotion-history.wxml   # 页面结构
└── emotion-history.wxss   # 页面样式
```

功能：
- 情绪变化趋势图
- 历史情绪记录列表
- 时间段筛选
- 详细情绪记录查看

### 7. 每日心情报告 (daily-report)

```
packageEmotion/pages/daily-report/
├── daily-report.js        # 页面逻辑
├── daily-report.json      # 页面配置
├── daily-report.wxml      # 页面结构
└── daily-report.wxss      # 页面样式
```

功能：
- 每日情绪总结
- 情绪分布饼图
- 关键词和话题分析
- 个性化建议和运势

### 8. 个人资料页面 (profile)

```
packageUser/pages/profile/
├── profile.js             # 页面逻辑
├── profile.json           # 页面配置
├── profile.wxml           # 页面结构
└── profile.wxss           # 页面样式
```

功能：
- 用户信息展示和编辑
- 使用统计数据
- 角色收藏管理
- 账号设置入口

### 9. 设置页面 (settings)

```
packageUser/pages/settings/
├── settings.js            # 页面逻辑
├── settings.json          # 页面配置
├── settings.wxml          # 页面结构
└── settings.wxss          # 页面样式
```

功能：
- 通知设置
- 隐私设置
- 数据管理
- 关于和帮助

## 组件设计

### 1. 聊天气泡组件 (chat-bubble)

```
components/chat-bubble/
├── index.js               # 组件逻辑
├── index.json             # 组件配置
├── index.wxml             # 组件结构
└── index.wxss             # 组件样式
```

功能：
- 用户/AI消息气泡样式
- 消息时间显示
- 情绪标签显示
- 长按复制功能

### 2. 聊天输入组件 (chat-input)

```
components/chat-input/
├── index.js               # 组件逻辑
├── index.json             # 组件配置
├── index.wxml             # 组件结构
└── index.wxss             # 组件样式
```

功能：
- 文本输入框
- 发送按钮
- 语音输入支持
- 表情选择器

### 3. 情绪卡片组件 (emotion-card)

```
components/emotion-card/
├── index.js               # 组件逻辑
├── index.json             # 组件配置
├── index.wxml             # 组件结构
└── index.wxss             # 组件样式
```

功能：
- 情绪类型展示
- 情绪强度显示
- 情绪图标和颜色
- 时间戳显示

### 4. 情绪图表组件 (emotion-chart)

```
components/emotion-chart/
├── index.js               # 组件逻辑
├── index.json             # 组件配置
├── index.wxml             # 组件结构
└── index.wxss             # 组件样式
```

功能：
- 情绪趋势线图
- 情绪分布饼图
- 图表交互功能
- 数据加载状态

### 5. 角色卡片组件 (role-card)

```
components/role-card/
├── index.js               # 组件逻辑
├── index.json             # 组件配置
├── index.wxml             # 组件结构
└── index.wxss             # 组件样式
```

功能：
- 角色头像和名称
- 角色描述和标签
- 选择状态显示
- 点击和长按事件

## 云函数设计

### 1. 登录云函数 (login)
功能：
- 用户登录和注册
- 微信授权信息获取 (`openid`, `session_key`)
- 用户信息初始化 (写入 `users` 集合)
- (可选) 生成和管理自定义登录态

### 2. 聊天云函数 (chat)
功能：
- **核心**: 接收用户消息，调用 **智谱 AI (GLM-4-Flash)** 生成回复。
- 聊天记录保存 (写入 `messages` 集合)。
- 历史消息获取 (支持分页)。
- 会话管理 (创建/更新 `chats` 集合记录)。
- **(@integration)** (可选，推荐) 集成**基础情绪分析**: 调用 GLM-4-Flash 时通过 Prompt 要求其在 JSON 输出中包含用户末句的情绪标签，并将结果存入 `emotion_records`。
- **(@dependency)** 依赖 `roles`, `chats`, `messages`, `emotion_records` 数据库集合。
- **(@dependency)** 依赖 **智谱 AI API (GLM-4-Flash)**。
- **(@security)** 需要安全管理智谱 AI API Key (使用云函数环境变量或安全配置)。

### 3. 情感与兴趣分析云函数 (analysis)
功能：
- **情绪历史获取**: 提供接口供前端查询指定时间段的 `emotion_records`。
- **情绪报告生成**:
    - 聚合指定时间段的 `emotion_records` 数据。
    - (可选) 调用 **智谱 AI (GLM-4-Flash)** 对情绪数据或相关对话进行总结、提取关键词、生成建议。
    - (可选，进阶) 结合 `user_interest_vectors` 中的 **Embedding** 向量进行聚类分析，提供更深层次的洞察。
- **兴趣分析 (核心技术: Embedding-3)**:
    - (可单独创建云函数 `interest_analysis` 或在此实现)
    - 接收用户对话文本。
    - 调用 **智谱 AI (Embedding-3)** 将文本转化为语义向量。
    - 将向量存入 `user_interest_vectors` 集合。
    - (后台任务) 定期对用户向量进行聚类分析、与预定义标签库进行相似度计算，构建用户兴趣画像。
    - **(@dependency)** 依赖 `emotion_records`, `user_interest_vectors` 数据库集合。
    - **(@dependency)** 依赖 **智谱 AI API (GLM-4-Flash, Embedding-3)**。

### 4. 角色管理云函数 (role)
功能：
- 角色列表获取 (包含角色的 `prompt`)。
- 角色详情查询。
- (后续) 自定义角色保存与管理。
- **(@dependency)** 依赖 `roles` 数据库集合。

### 5. 用户管理云函数 (user)
功能：
- 用户信息管理 (读写 `users` 集合)。
- 用户统计数据管理 (读写 `user_stats` 集合)。
- 用户偏好设置管理。
- (后续) 获取用户兴趣画像结果。
- **(@dependency)** 依赖 `users`, `user_stats` 数据库集合。

## 数据库设计

### 1. 用户集合 (users)
字段：
- _id: 用户ID
- openid: 微信OpenID
- nickname: 用户昵称 (来自 `wx.getUserProfile`)
- avatar_url: 头像URL (来自 `wx.getUserProfile`)
- gender: 性别 (来自 `wx.getUserProfile`)
- create_time: 创建时间
- last_login_time: 最后登录时间
- status: 账号状态 (active, inactive, etc.)
- preferences: 用户偏好设置 (Object)
  - theme: 主题偏好 ('light', 'dark', 'system')
  - notification_enabled: 是否开启通知 (Boolean)
  - language: 语言偏好 ('zh-CN', 'en-US', etc.)
- is_vip: 是否 VIP (Boolean)
- vip_expires_at: VIP 到期时间 (Timestamp)
- aggregated_interest_vector: 用户聚合兴趣向量 (Array<Number>) - 由 analysis 云函数更新
- interest_tags: 用户兴趣标签 (Array<Object{tag: String, score: Number, category: String}>) - 由 analysis 云函数更新
- emotional_profile: 用户情感画像 (Object)
  - dominant_emotions: 主导情绪 (Array<String>)
  - emotional_stability: 情绪稳定性评分 (Number, 0-100)
  - emotional_trends: 情绪趋势 (Array<Object{date: Date, emotion: String, intensity: Number}>)

### 2. 用户统计集合 (user_stats)
字段：
- _id: 统计ID (通常与 user_id 相同或关联)
- user_id: 用户ID
- total_chats: 总聊天会话数
- total_messages: 总消息数 (用户+AI)
- user_messages: 用户发送的消息数
- ai_messages: AI回复的消息数
- emotion_records_count: 情绪记录数
- emotion_distribution: 情绪分布 (Object{emotion: count})
- favorite_roles: 常用角色 (Array<Object{role_id: String, usage_count: Number, last_used: Timestamp}>)
- usage_time_stats: 使用时长统计 (Object)
  - total_time: 总使用时长 (分钟)
  - daily_average: 日均使用时长 (分钟)
  - weekly_stats: 每周使用统计 (Array<Object{week: String, time: Number}>)
- last_active_date: 最后活跃日期
- active_days_count: 活跃天数
- creation_date: 统计创建日期
- last_updated: 最后更新时间

### 3. 角色集合 (roles)
字段：
- _id: 角色ID
- name: 角色名称
- avatar: 角色头像 URL
- description: 角色描述
- category: 角色分类 ('family', 'friend', 'professional', 'other', etc.)
- relationship: 关系类型 ('parent', 'sibling', 'friend', 'mentor', etc.)
- tags: 角色标签 (Array<String>)
- age: 年龄 (Number 或 String)
- gender: 性别 ('male', 'female', 'other')
- occupation: 职业
- education_background: 教育背景
- hobbies: 爱好 (Array<String>)
- personality_traits: 性格特点 (Array<String>)
- emotional_tendency: 情感倾向
- communication_style: 说话风格
- background_story: 背景故事
- prompt: 角色核心 Prompt (用于指导 AI 行为)
- creator: 创建者ID (系统角色为 'system')
- isSystem: 是否系统角色 (Boolean)
- isRecommended: 是否推荐角色 (Boolean)
- create_time: 创建时间
- update_time: 最后更新时间
- usage_stats: 使用统计 (Object)
  - total_usage_count: 总使用次数
  - total_messages: 总消息数
  - user_count: 使用该角色的用户数
  - average_session_length: 平均会话长度 (消息数)
  - average_rating: 平均评分 (如果有评分功能)

### 4. 聊天会话集合 (chats)
字段：
- _id: 聊天会话 ID
- user_id: 用户ID
- role_id: 角色ID
- role_name: 角色名称 (冗余字段，方便查询)
- create_time: 创建时间
- last_message_time: 最后消息时间
- message_count: 消息数量
- **(后续)** summary: 对话摘要 (由 AI 生成，可选)

### 5. 消息集合 (messages)
字段：
- _id: 消息ID
- chat_id: 会话ID
- user_id: 用户ID
- role_id: 角色ID
- content: 消息内容
- sender: 发送者类型 ('user', 'ai')
- create_time: 创建时间
- status: 消息状态 ('sent', 'delivered', 'read', 'failed')
- emotion_tags: 情绪标签 (Array<String>, 可由 AI 分析生成)
- keywords: 关键词 (Array<String>, 可由 AI 分析生成)
- is_analyzed: 是否已分析 (Boolean)
- analysis_result: 分析结果 (Object, 如果有单条消息分析)

### 6. 情绪记录集合 (emotion_records)
字段：
- _id: 记录ID
- user_id: 用户ID
- message_id: 关联的消息ID
- chat_id: 关联的聊天会话 ID
- emotion_type: 情绪类型 (String, e.g., '开心', '悲伤')
- emotion_intensity: (可选) 情绪强度 (Number, 0-1)
- keywords: (可选) 相关关键词 (Array<String>) - 可由 AI 分析提供
- timestamp: 时间戳
- suggestions: (可选) 基于情绪的建议 (Array<String>) - 可由 AI 生成
- **(后续)** embedding_vector: (可选) 消息文本的 Embedding 向量 (Array<Number>) - 用于进阶分析

### 7. 用户兴趣向量集合 (user_interest_vectors) - **新增**
字段:
- _id: 向量记录 ID
- user_id: 用户 ID
- timestamp: 向量生成时间戳
- vector: **文本的 Embedding 向量** (Array<Number>) - 由 Embedding-3 生成
- source_text_snippet: (可选) 生成向量的原始文本片段 (String)
- source_message_id: (可选) 关联的消息 ID (String)
- source_chat_id: (可选) 关联的聊天会话 ID (String)

## 实现注意事项

1.  **AI API 安全**:
    *   **严禁**在小程序端或代码中硬编码 API Key。
    *   将智谱 AI API Key 存储在**云函数环境变量**或安全的配置文件中（确保加入 `.gitignore`）。
2.  **Prompt 工程**:
    *   精心设计 `roles` 集合中的 `prompt`，以引导 AI 扮演好角色并执行特定任务（如情绪分析）。
    *   持续迭代和优化 Prompt 以获得最佳效果。
3.  **性能优化**:
    *   分包加载、图片压缩、合理缓存依然重要。
    *   AI API 调用可能耗时，前端需要做好 Loading 状态提示，后端（云函数）可能需要设置合理的超时时间。
    *   考虑 AI API 的并发限制和流式输出 (`stream=True`) 优化前端体验。
    *   Embedding 分析和聚类等复杂计算应放在**后端异步执行**，避免阻塞主流程。
4.  **成本控制**:
    *   熟悉智谱 AI 各模型（GLM-4-Flash, Embedding-3 等）的计费方式。
    *   优化 Prompt 和对话历史长度，减少 Token 消耗。
    *   对于非实时性要求高的分析任务（如兴趣分析），采用**批量或定时处理**。
5.  **用户体验**:
    *   AI 回复的等待时间处理。
    *   情绪分析和兴趣分析结果的有效呈现。
    *   处理 AI API 调用失败或返回异常的情况。
6.  **数据隐私**:
    *   明确告知用户哪些数据会被用于分析。
    *   遵守相关法律法规，保护用户隐私。
7.  **可维护性与扩展性**:
    *   封装 AI API 调用逻辑。
    *   模块化设计分析功能（情绪、兴趣）。
    *   预留接口和字段以支持未来的模型升级或功能扩展。

## 开发流程建议

1.  **第一阶段**：基础框架与登录
   *   (同原计划)
2.  **第二阶段**：**核心 AI 对话集成**
   *   用户登录和认证。
   *   角色选择功能 (读取含 `prompt` 的角色数据)。
   *   **实现 `chat` 云函数基础功能，成功调用 GLM-4-Flash API 并返回回复**。
   *   实现聊天界面基础交互。
3.  **第三阶段**：**情绪感知与基础分析**
   *   **在 `chat` 云函数中集成基础情绪分析** (修改 Prompt, 使用 JSON 输出)。
   *   将情绪结果存入 `emotion_records`。
   *   实现 `emotion-analysis` 页面基础展示。
4.  **第四阶段**：**历史记录与报告**
   *   情绪历史页面开发 (查询 `emotion_records`)。
   *   每日报告页面开发 (聚合情绪数据，**调用 GLM-4-Flash 进行总结**)。
   *   完善图表组件。
5.  **第五阶段**：**兴趣分析与用户画像 (后台)**
   *   **实现调用 Embedding-3 生成文本向量**。
   *   设计并实现 `user_interest_vectors` 存储。
   *   **开发后台分析逻辑 (聚类、标签匹配)** - 这部分可能需要较多后端处理。
6.  **第六阶段**: 用户中心与设置
    *   (同原计划，可展示初步的用户画像标签)
7.  **第七阶段**：测试、优化、发布
   *   (同原计划，重点测试 AI 相关功能的稳定性和性能)




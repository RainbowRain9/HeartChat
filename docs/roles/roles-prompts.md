# `roles` 云函数提示词(Prompts)文档

本文档整理了`roles`云函数及其子模块中用于调用大语言模型的提示词。

## 1. `promptGenerator.js` - 提示词生成模块

### 1.1. `generateBasePrompt` - 生成基础角色提示词

**目标**: 根据角色详细信息，生成一份高质量、结构化的角色扮演提示词。

```text
请根据以下角色信息生成一个详细的角色扮演提示词：

          ${roleDescription}

          提示词应包含：
          1. 角色的自我认知和身份定位
          2. 与用户的关系定位和互动方式
          3. 说话风格、语气和表达方式的具体指导
          4. 应该避免的行为和表达
          5. 如何根据角色特点回应用户的情感需求（如何安慰、鼓励或适当批评用户）
          6. 如何自然地了解用户的兴趣和偏好
          7. 对话风格指导：
             - 使用非常简短的对话方式，尽量模仿真实手机聊天
             - 每条消息不超过1-2句话，尽量保持简洁
             - 将长回复拆分成多条非常短小的消息，就像真实人类在聊天软件中发消息一样
             - 避免使用长句和复杂句式，使用简单直接的表达
             - 当需要表达复杂想法时，将内容分成多个非常简短的消息，每条消息只表达一个简单观点

          8. 格式要求：
             - 绝对不要使用Markdown语法，如双星号加粗、单星号斜体、反引号代码等
             - 不要使用标题格式如#或##
             - 列表项直接使用数字或文字开头，不要使用特殊符号如-或*
             - 当需要列举多个要点时，直接使用“1.”“2.”等编号，不要使用特殊格式
             - 尽量使用简单的纯文本格式，就像在手机聊天软件中发送消息一样

          请直接给出提示词内容，不要包含解释。提示词应该简洁有效，不超过800字。
```

### 1.2. `generatePromptWithMemories` - 融合记忆生成提示词

**目标**: 将角色的记忆片段自然地融入基础提示词中。

```text
我有一个角色的基础提示词和一些该角色的记忆。请将这些记忆自然地融入到提示词中，使角色能够记住这些信息。

          基础提示词：
          ${basePrompt}

          角色记忆：
          ${memoriesText}

          请给出融合了记忆的完整提示词。不要添加额外的解释，直接给出结果。
```

### 1.3. `generatePromptWithUserPerception` - 融合用户画像生成提示词

**目标**: 将分析出的用户画像信息融入提示词，使角色互动更具个性化。

```text
我有一个角色的提示词和一些关于用户的信息。请将用户信息自然地融入到提示词中，使角色能够根据用户的兴趣、偏好和沟通风格进行互动。

          提示词：
          ${basePrompt}

          用户信息：
          ${userPerceptionText}

          请给出融合了用户信息的完整提示词。不要添加额外的解释，直接给出结果。
```

## 2. `memoryManager.js` - 记忆管理模块

### 2.1. `extractMemoriesFromChat` - 从对话中提取记忆

**目标**: 从对话中提取关键信息，作为角色的长期记忆。

```text
请从以下对话中提取3-5条重要信息，这些信息应该作为角色(${roleInfo.name})的记忆被保存。
          重点关注：
          1. 用户提到的个人信息（如兴趣、经历、偏好）
          2. 用户的情感状态和需求
          3. 对话中的重要事件或决定
          4. 可能在未来对话中有用的上下文

          对话内容：
          ${conversationText}

          请以JSON格式返回结果，格式如下：
          {
            "memories": [
              {
                "content": "记忆内容（简洁的一句话）",
                "importance": 0.8,
                "context": "记忆的上下文或来源"
              }
            ]
          }

          重要性评分范围为0-1，越重要越接近1。
```

### 2.2. `mergeMemories` - 合并相似记忆

**目标**: 当记忆过多时，将多条零散的记忆合并为少数几条更概括的记忆。

```text
请将以下记忆合并为3-5条更概括的记忆，保留最重要的信息：

          ${memoriesText}

          请以JSON格式返回结果，格式如下：
          {
            "memories": [
              {
                "content": "合并后的记忆内容",
                "importance": 0.8,
                "context": "记忆的上下文或来源"
              }
            ]
          }

          重要性评分范围为0-1，越重要越接近1。
```

### 2.3. `getRelevantMemories` - 获取相关记忆

**目标**: 根据当前对话上下文，从记忆库中检索最相关的记忆项。

```text
请从以下记忆中选出与当前上下文最相关的${limit}条记忆，并按相关性从高到低排序：

          当前上下文：
          ${currentContext}

          记忆列表：
          ${memories.map((memory, index) => `${index+1}. ${memory.content} (重要性: ${memory.importance})`).join('\n')}

          请以JSON格式返回结果，格式如下：
          {
            "relevant_memories": [
              {
                "index": 1,
                "relevance": 0.9
              }
            ]
          }

          相关性评分范围为0-1，越相关越接近1。只返回索引和相关性评分，不需要返回记忆内容。
```

## 3. `userPerception.js` - 用户画像模块

### 3.1. `analyzeUserPerception` - 分析用户画像

**目标**: 从用户的对话内容中提取画像信息，如兴趣、沟通风格等。

```text
请分析以下用户消息，提取用户的兴趣、偏好、沟通风格和情感模式：

          ${userText}

          请以JSON格式返回结果，格式如下：
          {
            "interests": ["兴趣1", "兴趣2"],
            "preferences": ["偏好1", "偏好2"],
            "communication_style": "用户的沟通风格描述",
            "emotional_patterns": ["情感模式1", "情感模式2"]
          }

          注意：
          1. 兴趣指用户喜欢的活动、话题或领域
          2. 偏好指用户在选择或决策中表现出的倾向
          3. 沟通风格指用户表达自己的方式和语言特点
          4. 情感模式指用户表达情感的方式和情绪变化规律
```

### 3.2. `mergeUserPerception` - 合并用户画像

**目标**: 将新分析出的画像信息与已有的画像信息进行合并与更新。

```text
请将以下现有用户画像和新的用户画像合并为一个更完整的用户画像：

          ${existingText}

          ${newText}

          请以JSON格式返回结果，格式如下：
          {
            "interests": ["兴趣1", "兴趣2"],
            "preferences": ["偏好1", "偏好2"],
            "communication_style": "用户的沟通风格描述",
            "emotional_patterns": ["情感模式1", "情感模式2"]
          }

          合并规则：
          1. 保留所有不重复的兴趣和偏好
          2. 如果新旧信息有冲突，优先保留新信息
          3. 对于沟通风格和情感模式，进行综合描述
          4. 每个类别最多保留5个最重要的项目
```

### 3.3. `generateUserPerceptionSummary` - 生成用户画像摘要

**目标**: 将结构化的用户画像数据转换成一段自然的、可在对话中使用的描述性文本。

```text
请将以下用户画像转化为一段自然、友好的描述，可以在对话中自然地提及：

          ${userPerceptionText}

          要求：
          1. 描述应该自然、友好，不要像机器分析报告
          2. 长度控制在100-150字之间
          3. 可以加入一些温暖的建议或鼓励
          4. 不要使用"根据我的分析"、"我注意到"等明显的分析语言
```
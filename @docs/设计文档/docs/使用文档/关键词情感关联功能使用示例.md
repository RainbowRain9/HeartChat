# 关键词情感关联功能使用示例

## 功能介绍

关键词情感关联功能用于将用户对话中的关键词与情感分析结果关联起来，帮助系统了解用户对不同话题的情感倾向，从而提供更加个性化的服务。

## 功能特性

- 自动提取对话中的关键词
- 将关键词与情感分析结果关联
- 支持情感分数计算和更新
- 支持获取用户关键词情感统计
- 支持按情感倾向（正面、负面、中性）分类关键词

## 使用方法

### 1. 在情感分析时自动关联关键词

在调用情感分析服务时，可以通过设置参数自动提取关键词并关联情感：

```javascript
// 导入情感分析服务
const emotionService = require('../../services/emotionService');

// 分析文本情感并关联关键词
async function analyzeTextEmotion(text, history = []) {
  const result = await emotionService.analyzeEmotion(text, {
    history: history,
    saveRecord: true,
    extractKeywords: true, // 启用关键词提取
    linkKeywords: true     // 启用关键词情感关联
  });
  
  return result;
}
```

### 2. 手动关联关键词与情感

如果需要手动关联关键词与情感，可以使用以下方法：

```javascript
// 导入情感分析服务
const emotionService = require('../../services/emotionService');

// 手动关联关键词与情感
async function linkKeywordsWithEmotion(userId, keywords, emotionResult) {
  const success = await emotionService.linkKeywordsToEmotion(
    userId,
    keywords,
    emotionResult
  );
  
  if (success) {
    console.log('关联关键词与情感成功');
  } else {
    console.error('关联关键词与情感失败');
  }
  
  return success;
}
```

### 3. 获取用户关键词情感统计

可以获取用户关键词的情感统计数据，了解用户对不同话题的情感倾向：

```javascript
// 导入情感分析服务
const emotionService = require('../../services/emotionService');

// 获取用户关键词情感统计
async function getKeywordEmotionStats(userId) {
  const stats = await emotionService.getKeywordEmotionStats(userId);
  
  // stats 包含三个数组：positive, negative, neutral
  const { positive, negative, neutral } = stats;
  
  console.log('正面情感关键词:', positive);
  console.log('负面情感关键词:', negative);
  console.log('中性情感关键词:', neutral);
  
  return stats;
}
```

### 4. 在页面中显示关键词情感统计

可以在页面中显示用户关键词的情感统计，帮助用户了解自己的情感倾向：

```html
<!-- 关键词情感统计 -->
<view class="keyword-emotion-stats">
  <view class="stats-title">关键词情感统计</view>
  
  <!-- 正面情感关键词 -->
  <view class="stats-section">
    <view class="section-title positive">正面情感关键词</view>
    <view class="keyword-list">
      <view class="keyword-item" wx:for="{{positiveKeywords}}" wx:key="word">
        <text class="keyword-text">{{item.word}}</text>
        <text class="keyword-score">({{item.score}})</text>
      </view>
    </view>
  </view>
  
  <!-- 负面情感关键词 -->
  <view class="stats-section">
    <view class="section-title negative">负面情感关键词</view>
    <view class="keyword-list">
      <view class="keyword-item" wx:for="{{negativeKeywords}}" wx:key="word">
        <text class="keyword-text">{{item.word}}</text>
        <text class="keyword-score">({{item.score}})</text>
      </view>
    </view>
  </view>
  
  <!-- 中性情感关键词 -->
  <view class="stats-section">
    <view class="section-title neutral">中性情感关键词</view>
    <view class="keyword-list">
      <view class="keyword-item" wx:for="{{neutralKeywords}}" wx:key="word">
        <text class="keyword-text">{{item.word}}</text>
        <text class="keyword-score">({{item.score}})</text>
      </view>
    </view>
  </view>
</view>
```

```javascript
Page({
  data: {
    positiveKeywords: [],
    negativeKeywords: [],
    neutralKeywords: []
  },
  
  onShow() {
    this.loadKeywordEmotionStats();
  },
  
  // 加载关键词情感统计
  async loadKeywordEmotionStats() {
    const userId = wx.getStorageSync('openId');
    if (!userId) return;
    
    const emotionService = require('../../services/emotionService');
    const stats = await emotionService.getKeywordEmotionStats(userId);
    
    this.setData({
      positiveKeywords: stats.positive || [],
      negativeKeywords: stats.negative || [],
      neutralKeywords: stats.neutral || []
    });
  }
});
```

## 实现原理

1. **关键词提取**：使用自然语言处理技术从用户对话中提取关键词
2. **情感分析**：分析用户对话的情感倾向，得到情感类型和强度
3. **关键词情感关联**：将关键词与情感分析结果关联，计算关键词的情感分数
4. **情感分数更新**：使用加权平均算法更新关键词的情感分数，确保分数能够反映用户的最新情感倾向
5. **情感统计**：按情感倾向（正面、负面、中性）对关键词进行分类，生成情感统计数据

## 数据结构

### 关键词数据结构

```javascript
{
  word: "旅行",        // 关键词
  weight: 1.5,         // 权重
  category: "娱乐",    // 分类
  emotionScore: 0.8,   // 情感分数（-1到1，负值表示负面情感，正值表示正面情感）
  source: "chat",      // 来源
  firstSeen: Date,     // 首次出现时间
  lastUpdated: Date,   // 最后更新时间
  occurrences: 5       // 出现次数
}
```

### 情感统计数据结构

```javascript
{
  positive: [          // 正面情感关键词
    {
      word: "旅行",
      score: 0.8,
      weight: 1.5,
      category: "娱乐"
    },
    // ...
  ],
  negative: [          // 负面情感关键词
    {
      word: "加班",
      score: -0.7,
      weight: 1.2,
      category: "工作"
    },
    // ...
  ],
  neutral: [           // 中性情感关键词
    {
      word: "天气",
      score: 0.1,
      weight: 1.0,
      category: "生活"
    },
    // ...
  ]
}
```

## 注意事项

1. 关键词情感关联功能需要用户登录并有有效的用户ID
2. 关键词情感关联功能依赖于情感分析和关键词提取功能
3. 关键词情感分数是动态更新的，会随着用户对话内容的变化而变化
4. 关键词情感统计数据会按情感分数和权重排序，排在前面的关键词更能代表用户的情感倾向
5. 关键词情感关联功能会自动在后台处理，不会影响主流程的执行
